<?xml version="1.0" encoding="utf-8"?>
<scxml version="1.0" xmlns="http://www.w3.org/2005/07/scxml" 
		xmlns:xi="http://www.w3.org/2001/XInclude"
		xmlns:ws="http://www.genesyslab.com/modules/ws"
		xmlns:queue="http://www.genesyslab.com/modules/queue"
		xmlns:dialog="http://www.genesyslab.com/modules/dialog"
		xmlns:session="http://www.genesyslab.com/modules/session"
		xmlns:ixn="http://www.genesyslab.com/modules/interaction"
		xmlns:classification="http://www.genesyslab.com/modules/classification"
		initial='_composer_noboot'
		profile="ecmascript"
		name="Main2">

	<!-- SCXML code generated by Composer 8.1.541.07 -->
	<!-- Diagram created/upgraded by Composer: Composer 8.1.541.07 -->
	<!-- Project version: 8.1.541.07 -->
	<!-- Diagram version: 1.0 CreatedOn:  -->
	<!-- Application Author:  -->
	<!-- Release Mode: false -->
	<!-- Use external events: true -->

	<final id="_composer_noboot">
		<onentry>
			<log expr="'This SCXML page cannot be executed as the first page of an application. The first page should always be the SCXML page generated from an Interaction Process Diagram (IPD).'" />
		</onentry>
	</final>
	<state id="_composer_entry" initial="$$_MY_PREFIX_$$.Entry1">
		<onentry>
			<log expr="'Running Main2 workflow.'"/>
			<log expr="'Code Generated by Composer: 8.1.541.07.'"/>
			<log expr="'Diagram created/upgraded by Composer: Composer 8.1.541.07.'"/>
			<log expr="'Project version: 8.1.541.07.'"/>
			<log expr="'Diagram version: 1.0 CreatedOn: .'"/>
			<script>
				// have this diagram system context sharing the global system context.
				// values from parent context (IPD or calling workflow) are used.
				// also IPD system handlers will update _data.system.context and hence this diagram system variables.
				var system = _data.system.context;

				// declare variables for all blocks in the diagram.
				// actual initialization is done in the entry block so expression evaluation exceptions can be caught.
				// there must be NO error in this part. all variables have to be declared before any error is raised so we can safely execute any error branch in the application.
				var App_Entry1 = new Object();
				var anncBusy = undefined;
				var anncPreXfer1 = undefined;
				var apiBlacklist = undefined;
				var apiBlackListFlg = undefined;
				var apiBlacklistType = undefined;
				var apiBodyPayload = undefined;
				var apiCompany = undefined;
				var apiCustName = undefined;
				var apiCustomerValue = undefined;
				var apiFirstName = undefined;
				var apiGrading = undefined;
				var apiIVRProfileMap = undefined;
				var apiLastName = undefined;
				var apiMemberType = undefined;
				var apiMessage = undefined;
				var apiSurveyTempId = undefined;
				var apiWhiteListFlg = undefined;
				var blacklistOpmName = undefined;
				var gvp_exitmenu = undefined;
				var gvp_exitmenu_main = undefined;
				var gvp_exitmenu_survey = undefined;
				var gvp_exitmenu_vip = undefined;
				var gvp_exitmenu_vvip = undefined;
				var gvp_extension = undefined;
				var gvp_opm_main = undefined;
				var gvp_opm_survey = undefined;
				var gvpServiceMapping = undefined;
				var httpResponse = undefined;
				var httpResponseStatus = undefined;
				var httpResult = undefined;
				var httpStatusCode = undefined;
				var opmGlobalSetting = undefined;
				var outplayapp1 = undefined;
				var outplayapp2 = undefined;
				var outplayapp3 = undefined;
				var playMain_crd_m01annc_enable = undefined;
				var playMainOpmName = undefined;
				var playMainOpmValue = undefined;
				var playMainOutput1 = undefined;
				var playMainOutput2 = undefined;
				var playMainOutput3 = undefined;
				var playMainOutput4 = undefined;
				var playSurvey_gvp_exitmenu = undefined;
				var playSurvey_gvp_opm = undefined;
				var playSurveyExitMenuValue = undefined;
				var playSurveyOpmName = undefined;
				var playSurveyOpmValue = undefined;
				var prmptIdx = undefined;
				var restRespStatus = undefined;
				var restStatusCode = undefined;
				var routeBy = undefined;
				var routeDestination = undefined;
				var routeTargetExpr = undefined;
				var routeType = undefined;
				var routeVQName = undefined;
				var varAMLUrl = undefined;
				var varCustLevel = undefined;
				var varCustomerGrading = undefined;
				var varDefaultIVRProfile = undefined;
				var varException = undefined;
				var varGreetPromptUrl = undefined;
				var varHttpResp = undefined;
				var varHttpStatus = undefined;
				var varInputValue = undefined;
				var varPlaceExpr1 = undefined;
				var varPlaceExpr2 = undefined;
				var varPlaceExpr3 = undefined;
				var varPlayAppResource = undefined;
				var varReqId = undefined;
				var varRouteHint = undefined;
				var varRoutingDNFromLogic = undefined;
				var varRoutingTimeout = undefined;
				var varSipLatitude = undefined;
				var varSipLongtitude = undefined;
				var varSipSelPSAP = undefined;
				var varSkillExpr = undefined;
				var varSkillExpr1 = undefined;
				var varSkillExpr2 = undefined;
				var varSkillExpr3 = undefined;
				var varSurveyApiReqBody = undefined;
				var varSurveyApiToken = undefined;
				var varSurveyApiUrl = undefined;
				var varSurveyPayload = undefined;
				var varSurveyTemplateId = undefined;
				var varSurveyThkUrl = undefined;
				var varSurveyVoiceUrl = undefined;
				var varValue = undefined;
				var varVipIVRProfile = undefined;
				var varVVipIVRProfile = undefined;
				var whitelistOpmName = undefined;
				var wreqUrl = undefined;
				var outidcardno = undefined;
				var outlastevent = undefined;
				var varAskIDCardNo = undefined;
				var routeBusyAnncProfile = undefined;
				var routeBusyTreatment = undefined;
				var routePreXferTreatement = undefined;
				var routeTargetTimeout = undefined;
				var routePriority = undefined;
				var App_Exit1 = new Object();
				var App_SetRouteHint = new Object();
				var App_playMain = new Object();
				var App_emsSetMainParam = new Object();
				var App_UserData1 = new Object();
				var App_Disconnect2 = new Object();
				var App_TargetBySkill1 = new Object();
				var App_emsParseApiResult = new Object();
				var App_restGetProfile = new Object();
				var App_emsAttachInitUData = new Object();
				var App_bchIsBlackList = new Object();
				var App_emsReadGlobalParam = new Object();
				var App_emsMapSvcCallFlow = new Object();
				var App_logAband = new Object();
				var App_logIxnDelete = new Object();
				var App_emsParseEmergency = new Object();
				var App_emsGetCallFlowValue = new Object();
				var App_emsGetRouteConfig = new Object();
				var App_bchRouteType = new Object();
				var App_forceRouteNT = new Object();
				var App_RouteEmergency = new Object();
				var App_postJourneyEnd = new Object();
				var App_emsSetPayload3 = new Object();
				var App_emsSetPayload4 = new Object();
				var App_postJourneyStart01 = new Object();
				var App_emsJourneyBody01 = new Object();
				var App_Assign1 = new Object();
				var App_bchNextAction = new Object();
				var App_postJourneyEnd4 = new Object();
				var App_emsSetPayload2 = new Object();
				var App_Disconnect3 = new Object();
				var App_emsAttachIDCard = new Object();
				var App_TargetByCPDAG = new Object();
				var App_forceLG = new Object();
				var App_papBusyAnncCRD = new Object();
				var App_subPreXferModule = new Object();
				var App_bchCheckNPA = new Object();
				var App_papBusyAnncNPA = new Object();
				var App_TargetByNPAAG = new Object();
				var App_emsCPDBusyTreatment = new Object();
				var App_bchIsPreXferEnable = new Object();
				var App_emsGetPreXferConfig = new Object();
				var App_emsNPABusyTreatment = new Object();
				var App_WaitEvent1 = new Object();
				var App_weWait1Sec = new Object();
				var App_AddPriority1 = new Object();
				var App_AddPriority2 = new Object();
			</script>
		</onentry>
		
			<transition event="interaction.deleted" cond="_event.data.interactionid == system.InteractionID &amp;&amp; (!_event.data.resultof || _event.data.resultof == 'deletion')" target="$$_MY_PREFIX_$$.logIxnDelete">
				<log expr="'Composer Application: Main2 global error'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("Entry1", _event);
				]]>
				</script>
			</transition>
			<transition event="interaction.abandoned" target="$$_MY_PREFIX_$$.logAband">
				<log expr="'Composer Application: Main2 global error'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("Entry1", _event);
				]]>
				</script>
			</transition>
			
		<!-- This is the Entry1 State -->
		<state id="Entry1">
			<onentry>
				<log expr="_sessionid + ': Inside Entry Block: Entry1'"/>
				<script>
					// update the system and user variables with values set by the user in the variables dialog
					system.diagram = 'Main2';
					anncBusy = 'http://192.168.2.161/arm/1111715_pcmu.wav';
					anncPreXfer1 = 'http://192.168.2.161/arm/1111615_pcma.wav';
					apiBlacklist = 0;
					apiBlackListFlg = 0;
					apiBlacklistType = '';
					apiBodyPayload = undefined;
					apiCompany = '';
					apiCustName = '';
					apiCustomerValue = '';
					apiFirstName = '';
					apiGrading = '';
					apiIVRProfileMap = undefined;
					apiLastName = '';
					apiMemberType = '';
					apiMessage = '';
					apiSurveyTempId = 0;
					apiWhiteListFlg = 0;
					blacklistOpmName = 'GHB_GVP_BLACKLIST';
					gvp_exitmenu = undefined;
					gvp_exitmenu_main = undefined;
					gvp_exitmenu_survey = undefined;
					gvp_exitmenu_vip = '';
					gvp_exitmenu_vvip = '';
					gvp_extension = undefined;
					gvp_opm_main = undefined;
					gvp_opm_survey = undefined;
					gvpServiceMapping = undefined;
					httpResponse = undefined;
					httpResponseStatus = undefined;
					httpResult = undefined;
					httpStatusCode = undefined;
					opmGlobalSetting = 'GLOBAL_GVP_SETTING_PG';
					outplayapp1 = undefined;
					outplayapp2 = undefined;
					outplayapp3 = undefined;
					playMain_crd_m01annc_enable = '';
					playMainOpmName = 'GHB_CRD_IVR_POC_PG';
					playMainOpmValue = undefined;
					playMainOutput1 = undefined;
					playMainOutput2 = undefined;
					playMainOutput3 = undefined;
					playMainOutput4 = undefined;
					playSurvey_gvp_exitmenu = undefined;
					playSurvey_gvp_opm = undefined;
					playSurveyExitMenuValue = undefined;
					playSurveyOpmName = '';
					playSurveyOpmValue = undefined;
					prmptIdx = undefined;
					restRespStatus = undefined;
					restStatusCode = undefined;
					routeBy = undefined;
					routeDestination = undefined;
					routeTargetExpr = undefined;
					routeType = undefined;
					routeVQName = undefined;
					system.BaseURL = getBaseURL();
					system.Language = 'en-US';
					system.LastErrorDescription = 'undefined';
					system.LastErrorEvent = 'undefined';
					system.LastErrorEventName = 'undefined';
					system.LastSubmitRequestId = 'undefined';
					system.LastTargetComponentSelected = 'undefined';
					system.LastTargetObjectSelected = 'undefined';
					system.LastTargetSelected = 'undefined';
					system.LastVirtualQueueSelected = 'undefined';
					system.OCS_Record = getWorkflowOCSRecord();
					system.OCS_RecordURI = getWorkflowRecordURI();
					system.OCS_URI = getWorkflowOCSURI();
					system.OPM = getOPMParameters();
					system.RelativePathURL = getRelativePathURL();
					system.TerminateIxnOnExit = 1;
					system.WebServiceStubbing = '0';
					varAMLUrl = '';
					varCustLevel = 'n/a';
					varCustomerGrading = '';
					varDefaultIVRProfile = 'GHB_POC_IVRPROF';
					varException = '';
					varGreetPromptUrl = 'http://192.168.2.161/arm/1103615_pcma.wav';
					varHttpResp = undefined;
					varHttpStatus = undefined;
					varInputValue = '';
					varPlaceExpr1 = undefined;
					varPlaceExpr2 = undefined;
					varPlaceExpr3 = undefined;
					varPlayAppResource = &quot;http://192.168.2.161:9001/GHB_GVP_Callflow-20240222174004.804/src-gen/Main.vxml&quot;;
					varReqId = undefined;
					varRouteHint = undefined;
					varRoutingDNFromLogic = '7004';
					varRoutingTimeout = '10';
					varSipLatitude = '0';
					varSipLongtitude = '0';
					varSipSelPSAP = '';
					varSkillExpr = '?:(psap3 &gt; 0)@Stat_Server.GA';
					varSkillExpr1 = '?:(psap1 &gt; 0)@Stat_Server.GA';
					varSkillExpr2 = '?:(psap2 &gt; 0)@Stat_Server.GA';
					varSkillExpr3 = '?:(psap3 &gt; 0)@Stat_Server.GA';
					varSurveyApiReqBody = undefined;
					varSurveyApiToken = undefined;
					varSurveyApiUrl = 'http://172.19.22.157/v1/apienpoint/genesys/submitivrsurvey';
					varSurveyPayload = undefined;
					varSurveyTemplateId = undefined;
					varSurveyThkUrl = 'http://192.168.2.161/arm/1105115_pcmu.wav';
					varSurveyVoiceUrl = undefined;
					varValue = undefined;
					varVipIVRProfile = 'GHB_VIP_IVRPROF';
					varVVipIVRProfile = 'GHB_VVIP_IVRPROF';
					whitelistOpmName = 'GHB_GVP_WHITELIST';
					wreqUrl = 'http://172.19.22.157/api/v1/apienpoint/genesys/getDetailByPhoneKey';
					outidcardno = undefined;
					outlastevent = undefined;
					varAskIDCardNo = undefined;
					routeBusyAnncProfile = undefined;
					routeBusyTreatment = undefined;
					routePreXferTreatement = undefined;
					routeTargetTimeout = undefined;
					routePriority = undefined;
				</script>
				<log expr="'RelativePathURL = ' + system.RelativePathURL" />
				<send event="'Entry1.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="Entry1.done" cond="_event.data.resolveid == _my_prefix" target="$$_MY_PREFIX_$$.emsReadGlobalParam">
				<script>storeEvent("Entry1", _event);</script>
			</transition>
		</state>

		<!-- This is the Exit1 State -->
		
		<state id="Exit1">
		
			<onentry>
			</onentry>
			<transition cond="(typeof system.InteractionID != 'undefined')
						&amp;&amp; (_genesys.ixn.interactions[system.InteractionID] != null)
						&amp;&amp; (typeof _genesys.ixn.interactions[system.InteractionID] != 'undefined')
						&amp;&amp; (typeof _genesys.ixn.interactions[system.InteractionID].voice == 'undefined')
						&amp;&amp; (system.TerminateIxnOnExit == '1' || system.TerminateIxnOnExit == 1)"  target="$$_MY_PREFIX_$$._reserved_Exit1_stop_ixn"/>
			<transition target="$$_MY_PREFIX_$$._reserved_Exit1_final"/>
		</state>
		<state id="_reserved_Exit1_stop_ixn">
			<onentry>
				<ixn:terminate requestid="App_Exit1['requestid']" interactionid="system.InteractionID" reason="'Auto-stop interaction'"/>
			</onentry>
			<transition event="interaction.terminate.done" cond="_event.data.requestid==App_Exit1['requestid']" target="$$_MY_PREFIX_$$._reserved_Exit1_final"/>
			<transition event="error.interaction.terminate" cond="_event.data.requestid==App_Exit1['requestid']" target="$$_MY_PREFIX_$$._reserved_Exit1_final"/>
		</state>
		<final id="_reserved_Exit1_final">
			<onentry>
				<log expr="_sessionid + ': Reached final in Exit Block: _reserved_Exit1_final. End of this session'" />
			</onentry>
		</final>

		<!-- This is the SetRouteHint State -->
		<state id="SetRouteHint">
			<onentry>
				<log expr="_sessionid + ': Inside Assign Block: SetRouteHint'" />
				<log expr="'outplayapp1 = ' + outplayapp1" level="2" />
				<log expr="'outplayapp2 = ' + outplayapp2" level="2" />
				<log expr="'outplayapp3 - ' + outplayapp3" level="2" />
				<script>
					varRouteHint = {'extensions': {'agent-greeting-type':&quot;vxml&quot;,'agent-greeting': &quot;&quot;, 'customer-greeting': &quot;announcement/AgentGreeting/5101.wav&quot;}};					
						
					prmptIdx = 1;					
						
				</script>
				<send event="'SetRouteHint.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="SetRouteHint.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.bchRouteType">
				<script>storeEvent("SetRouteHint", _event);</script>
			</transition>
		</state>


	
		<!-- This is the playMain State -->
		<state id="playMain">
			<initial>
				<transition target="$$_MY_PREFIX_$$._reserved_playMain_play">
					<log expr="_sessionid + ': Inside PlayApplication Block: playMain '"/>
				<log expr="'varPlayAppResource -' + varPlayAppResource" level="2" />
				</transition>
			</initial>
			<state id="_reserved_playMain_play">
				<onentry>
				<dialog:start type="'applid'" interactionid="system.InteractionID" requestid="varReqId">
    				<param name="APP_URI"  expr="varPlayAppResource" />
    				<param name="LANGUAGE" expr="'English (US)'" />
				</dialog:start>
				</onentry>
				<transition event="dialog.start.done" cond="_event.data.requestid==varReqId" target="$$_MY_PREFIX_$$.emsGetCallFlowValue">
					<script>storeEvent("playMain", _event);</script>
					<script>
						outplayapp1 = _genesys.ixn.interactions[system.InteractionID].udata['outivrmenu'];
						outplayapp2 = _genesys.ixn.interactions[system.InteractionID].udata['ivrdisconnect'];
						outplayapp3 = _genesys.ixn.interactions[system.InteractionID].udata['outidcardno'];
					</script>
				<assign location="gvp_exitmenu_main" expr="_event.data.extensions"/>
				</transition>
			<transition event="error.dialog.start" cond="_event.data.requestid==App_playMain['requestid']" target="$$_MY_PREFIX_$$.RouteEmergency">
				<log expr="'Composer Application: Main2 Block: playMain'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("playMain", _event);
				]]>
				</script>
				<assign location="gvp_exitmenu_main" expr="_event.data.extensions"/>
			</transition>
			</state>
		</state>
	
	
	

		<!-- This is the UserData1 State -->
		<state id="UserData1">
			<initial>
				<transition target="$$_MY_PREFIX_$$._reserved_UserData1_start">
					<log expr="_sessionid + ': Inside UserData Block: UserData1'" />
				</transition>
			</initial>
			<state id="_reserved_UserData1_start">
			<onentry>			    
				<if cond="typeof system.InteractionID == 'undefined'">
					<raise event="error.com.genesyslab.composer.noudata">
						<param name="description" expr="'system.InteractionID variable is not defined'"/>
					</raise>
				<elseif cond="(typeof _genesys.ixn.interactions == 'undefined')
							|| (_genesys.ixn.interactions[system.InteractionID] == null)
							|| (typeof _genesys.ixn.interactions[system.InteractionID] == 'undefined')
							|| (typeof _genesys.ixn.interactions[system.InteractionID].udata == 'undefined')"/>
					<raise event="error.com.genesyslab.composer.noudata">
						<param name="description" expr="'No User data is associated with interaction ' + system.InteractionID"/>
					</raise>
				<else/>
					<send event="'UserData1.wait.timeout'" idlocation="App_UserData1['requestid']" delay="'10s'">
					<param name="resolveid" expr="_my_prefix"/>
					</send>
					<script><![CDATA[
						App_UserData1['setudata'] = false;
						var data = new Object();
						if (_genesys.ixn.interactions[system.InteractionID].udata['gsw-ivr-profile-name'] != varDefaultIVRProfile && typeof varDefaultIVRProfile != 'undefined') {
							data['gsw-ivr-profile-name'] = varDefaultIVRProfile;
							App_UserData1['setudata'] = true;
						}
						if (_genesys.ixn.interactions[system.InteractionID].udata['ghb-dnis'] != system.DNIS && typeof system.DNIS != 'undefined') {
							data['ghb-dnis'] = system.DNIS;
							App_UserData1['setudata'] = true;
						}
						if (_genesys.ixn.interactions[system.InteractionID].udata['ghb-cust-level'] != varCustLevel && typeof varCustLevel != 'undefined') {
							data['ghb-cust-level'] = varCustLevel;
							App_UserData1['setudata'] = true;
						}
						if (_genesys.ixn.interactions[system.InteractionID].udata['ghb-cust-name'] != apiCustName && typeof apiCustName != 'undefined') {
							data['ghb-cust-name'] = apiCustName;
							App_UserData1['setudata'] = true;
						}
						if (_genesys.ixn.interactions[system.InteractionID].udata['ghb-company'] != apiCompany && typeof apiCompany != 'undefined') {
							data['ghb-company'] = apiCompany;
							App_UserData1['setudata'] = true;
						}
						if (_genesys.ixn.interactions[system.InteractionID].udata['Composer_internal_key'] != 1728472670) {
							data['Composer_internal_key'] = 1728472670;
							App_UserData1['setudata'] = true;
						}
						if (App_UserData1['setudata']) {
							__Log('setting udata:' + JSON.stringify(data));
							_genesys.ixn.setuData(data, system.InteractionID);
						}
			    	]]></script>
				</if>
			</onentry>
			<transition event="UserData1.wait.timeout" cond="_event.data.resolveid == _my_prefix" target="$$_MY_PREFIX_$$.playMain">
				<script>storeEvent("UserData1", _event);</script>
			</transition>
			<transition event="interaction.udata.changed" target="$$_MY_PREFIX_$$._reserved_UserData1_outputTransition" cond="(typeof App_UserData1['setudata'] != 'undefined')
																						&amp;&amp; (_genesys.ixn.interactions[system.InteractionID].udata['Composer_internal_key'] == 1728472670)">
					<cancel sendid="App_UserData1['requestid']"/>
					<script>storeEvent("UserData1", _event);</script>
			</transition>
			
			<transition target="$$_MY_PREFIX_$$.playMain" cond="(typeof App_UserData1['setudata'] != 'undefined') &amp;&amp; !App_UserData1['setudata']">
				<log expr="'udata is up to date. Transitioning out.'" />
			</transition>
			<transition event="error" target="$$_MY_PREFIX_$$.RouteEmergency">
				<log expr="'Composer Application: Main2 Block: UserData1'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("UserData1", _event);
				]]>
				</script>
			</transition>
			</state>
			<state id="_reserved_UserData1_outputTransition">
				<transition event="cancel.successful" target="$$_MY_PREFIX_$$.playMain">
            	</transition>
			
				<transition event="error.notallowed" target="$$_MY_PREFIX_$$.playMain">
					<log expr="'Received error.notallowed event in the block : UserData1, Ignoring this event'" />
				</transition>		
			</state>
		</state>
		<!-- This is the Disconnect2 State -->
		<final id="Disconnect2">
			<onentry>
				<log expr="_sessionid + ': Inside Disconnect Block: Disconnect2'" />
				<ixn:terminate requestid="App_Disconnect2['requestid']" interactionid="system.InteractionID" reason="'Disconnect interaction'"/>
			</onentry>
		</final>

		<!-- This is the TargetBySkill1 State -->
		<state id="TargetBySkill1">
						
			<initial>
				<transition target="$$_MY_PREFIX_$$._reserved_TargetBySkill1_submit">
					<log expr="_sessionid + ': Inside Target Block: TargetBySkill1 '"/>
				<log expr="'varSkillExpr - ' + varSkillExpr" level="2" />
				</transition>
			</initial>
			
			<state id="_reserved_TargetBySkill1_submit">
				<onentry>
					<queue:submit route="false" requestid="App_TargetBySkill1['requestid']" interactionid="system.InteractionID" queue="'VQ_GHB_ALL_GEN_SIPDC1'" timeout="toNumber(_data.defaultTargetTimeout)" clearontimeout="true" ordertype="'max'" orderstat="'StatAgentLoading'">
						<queue:targets>
							<queue:targetid expr="routeTargetExpr"/>						
						</queue:targets>
					</queue:submit>
				</onentry>
				<transition event="queue.submit.requestid" cond="_event.data.requestid==App_TargetBySkill1['requestid']">
					<script>storeEvent("TargetBySkill1", _event);</script>
					<assign location="App_TargetBySkill1['queue.submit.requestid']" expr="_event.data.requestid"/>
					<assign location="system.LastSubmitRequestId" expr="_event.data.requestid"/>
					<assign location="varReqId" expr="_event.data.requestid"/>
				</transition>
				<transition event="queue.submit.done" cond="_event.data.requestid==App_TargetBySkill1['requestid']" target="$$_MY_PREFIX_$$._reserved_TargetBySkill1_fetch_deviation">
					<log expr="'Target Selection DONE'" />
					<log expr="'Composer Application:Main2 Block: TargetBySkill1'" />
					<log expr="'Target selected:' + _event.data.targetselected" />
					<if cond="typeof system.InteractionID != 'undefined' &amp;&amp; system.InteractionID != null &amp;&amp; _genesys.ixn.interactions[system.InteractionID] != null &amp;&amp; typeof _genesys.ixn.interactions[system.InteractionID] != 'undefined' &amp;&amp; typeof _genesys.ixn.interactions[system.InteractionID].voice != 'undefined'">
						<log expr="'_genesys.ixn.interactions[system.InteractionID].voice.ani: ' + _genesys.ixn.interactions[system.InteractionID].voice.ani" />
						<log expr="'_genesys.ixn.interactions[system.InteractionID].ani: ' + _genesys.ixn.interactions[system.InteractionID].ani" />
					<else/>
						<log expr="'Interaction is null'" />
					</if>
					<script>storeEvent("TargetBySkill1", _event);</script>
					<assign location="system.LastTargetComponentSelected" expr="_event.data.targetcomponentselected"/>
					<assign location="system.LastTargetObjectSelected" expr="_event.data.targetobjectselected"/>
					<assign location="system.LastTargetSelected" expr="_event.data.targetselected"/>
					<assign location="system.LastVirtualQueueSelected" expr="_event.data.vqselected"/>
					<assign location="App_TargetBySkill1['targetResource']" expr="_event.data.resource"/>
					</transition>
			</state>
			<state id="_reserved_TargetBySkill1_submit_delay">
				<onentry>
					<send event="'TargetBySkill1.aftersubmit.timeout.elapsed'" delay="'200ms'">
					<param name="resolveid" expr="_my_prefix"/>
					</send>
				</onentry>
				<transition event="TargetBySkill1.aftersubmit.timeout.elapsed" cond="_event.data.resolveid == _my_prefix" target="$$_MY_PREFIX_$$._reserved_TargetBySkill1_detach"/>
			</state>
			<state id="_reserved_TargetBySkill1_detach" initial="$$_MY_PREFIX_$$._reserved_TargetBySkill1_detach_run">
				<onentry>
					<log expr="'Detach the interaction ' + system.InteractionID"/>
					<script>var App_TargetBySkill1_Detach_Timeout = new Date().getTime() + 300;</script>
				</onentry>
				<state id="_reserved_TargetBySkill1_detach_run">
					<onentry>
						<log expr="'Detach attempt for interaction ' + system.InteractionID"/>
						<ixn:detach interactionid="system.InteractionID" requestid="App_TargetBySkill1['requestid']"/>
					</onentry>
					<transition event="interaction.detach.done" cond="_event.data.requestid==App_TargetBySkill1['requestid']" target="$$_MY_PREFIX_$$._reserved_TargetBySkill1_redirect">
						<script>storeEvent("TargetBySkill1", _event);</script>
				<assign location="App_TargetBySkill1['interaction.detach.requestid']" expr="_event.data.requestid"/>
					</transition>
					<transition event="error.interaction.detach" cond="(_event.data.requestid==App_TargetBySkill1['requestid']) &amp;&amp; (_event.data.error=='invalidstate') &amp;&amp; ((new Date().getTime() + 200) &lt; App_TargetBySkill1_Detach_Timeout)" target="$$_MY_PREFIX_$$._reserved_TargetBySkill1_detach_delay"/>
				</state>
				<state id="_reserved_TargetBySkill1_detach_delay">
					<onentry>
						<send event="'TargetBySkill1.afterdetach.timeout.elapsed'" delay="'200ms'"/>
					</onentry>
					<transition event="TargetBySkill1.afterdetach.timeout.elapsed" target="$$_MY_PREFIX_$$._reserved_TargetBySkill1_detach_run"/>
				</state>
			</state>
			<state id="_reserved_TargetBySkill1_attach">
				<onentry>
					<log expr="'Attach the interaction back'" />
					<ixn:attach interactionid="system.InteractionID" requestid="App_TargetBySkill1['requestid']"/>
				</onentry>
				<transition event="interaction.attach.done" cond="_event.data.requestid==App_TargetBySkill1['requestid']">
					<script>storeEvent("TargetBySkill1", _event);</script>
				<assign location="App_TargetBySkill1['interaction.attach.requestid']" expr="_event.data.requestid"/>
					<script>
						App_TargetBySkill1['requestid'] = App_TargetBySkill1['error.rethrow'].params.requestid;
						__Raise(App_TargetBySkill1['error.rethrow'].name, App_TargetBySkill1['error.rethrow'].params);
					</script>
				</transition>
			</state>
			<state id="_reserved_TargetBySkill1_fetch_deviation">
				<transition target="$$_MY_PREFIX_$$._reserved_TargetBySkill1_redirect">
					<log expr="_sessionid + ': Target Deviation from Ideal Agent'" />
				</transition>
			</state>
			<state id="_reserved_TargetBySkill1_redirect">
				<onentry>
					<log expr="_sessionid + ': Inside Target Redirect: TargetBySkill1 '" />
					<ixn:redirect detach="true" requestid="App_TargetBySkill1['requestid']" interactionid="system.InteractionID" from="system.ThisDN" to="App_TargetBySkill1['targetResource']" type="_genesys.queue.rType.RouteTypeDefault" hints="varRouteHint"/>
				</onentry>
			<transition event="interaction.redirect.done" cond="_event.data.requestid==App_TargetBySkill1['requestid']" target="$$_MY_PREFIX_$$.emsSetPayload4">
				<script>storeEvent("TargetBySkill1", _event);</script>
				<assign location="App_TargetBySkill1['interaction.redirect.requestid']" expr="_event.data.requestid"/>
			</transition>
				
			</state>
		</state>

		<!-- This is the emsParseApiResult State -->
		<state id="emsParseApiResult">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsParseApiResult'"/>
				<log expr="'httpResult - ' +JSON.stringify(httpResult)" level="2" />
				<script>
					(function(){
					try {
						// your code 00001
						__Log('### Http Response = ' + JSON.stringify(httpResult));
						
						
						apiFirstName = getJSONContent(httpResult, 'contact.firstname');
						apiFirstName = (apiFirstName === null) ? 'n/a' : apiFirstName;
						
						apiLastName = getJSONContent(httpResult, 'contact.lastname');	
						apiLastName = (apiLastName === null) ? 'n/a' : apiLastName;
						
						apiCompany = getJSONContent(httpResult, 'contact.company');
						apiCompany = (apiCompany === null) ? 'n/a' : apiCompany;
							
						apiSurveyTempId = getJSONContent(httpResult, 'contact.survey_temp_id');
						apiSurveyTempId = (apiSurveyTempId === null) ? 0 : apiSurveyTempId;
						
						apiCustomerValue = getJSONContent(httpResult, 'contact.customervalue');
						apiCustomerValue = (apiCustomerValue === null) ? 'n/a' : apiCustomerValue
						
						apiBlacklistType = getJSONContent(httpResult, 'contact.blacklist_type');
						apiBlacklistType = (apiBlacklistType === null) ? 'none' : apiBlacklistType
						
						apiMemberType = getJSONContent(httpResult, 'contact.member_type');
						apiMemberType = (apiMemberType === null) ? 'general' : apiMemberType
						
						apiBlackListFlg = getJSONContent(httpResult, 'contact.blacklist_flg');
						apiBlackListFlg = (apiBlackListFlg === null) ? 0 : apiBlackListFlg
						
						apiWhiteListFlg = getJSONContent(httpResult, 'contact.whitelist_flg');
						apiWhiteListFlg = (apiWhiteListFlg === null) ? 0 : apiWhiteListFlg
						
						apiMessage = getJSONContent(httpResult, 'message');
						apiMessage = (apiMessage === null) ? 'n/a' : apiMessage
						
						apiCustName = apiFirstName + ' ' + apiLastName;
						
						__Log('### apiFirstName = '+apiFirstName);
						__Log('### apiLastName = '+apiLastName);
						__Log('### apiCompany = '+apiCompany);
						__Log('### apiSurveyTempId = '+apiSurveyTempId);
						__Log('### apiCustomerValue = '+apiCustomerValue);
						__Log('### apiBlacklistType = '+apiBlacklistType);
						__Log('### apiMemberType = '+apiMemberType);
						__Log('### apiBlackListFlg = '+apiBlackListFlg);
						__Log('### apiWhiteListFlg = '+apiWhiteListFlg);
						__Log('### apiMessage = '+apiMessage);
					
					
					} catch (err) {
						// error handling code
						__Log('@@@@@@ Exception Found - ' + err + '@@@@@@');
						throw new Error('Exception Found'); 
					}
					
					})();
				</script>
				<send event="'emsParseApiResult.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsParseApiResult.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.emsAttachInitUData">
				<script>storeEvent("emsParseApiResult", _event);</script>
			</transition>
			<transition event="error" target="$$_MY_PREFIX_$$.emsParseEmergency">
				<log expr="'Composer Application: Main2 Block: emsParseApiResult'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("emsParseApiResult", _event);
				]]>
				</script>
			</transition>
		</state>

		<!-- This is the restGetProfile State -->
		<state id="restGetProfile">
			<onentry>
			    <log expr="_sessionid + ': Inside HTTPRest Block: restGetProfile'" />

				<script>
				 var customHeaders = new Object();
				 customHeaders["apiKey"] = _data.cdpAppKey;
    			</script>
				<session:fetch requestid="App_restGetProfile['requestid']"
					       srcexpr="_data.cdpGetDetailByPhone" method="'get'" enctype="'application/x-www-form-urlencoded'" maxage="0"
					       maxstale="0" type="'application/json'" gdelivery="false" 
					       gd_retries="1" gd_retry_interval="0" timeout="10" headers="customHeaders">
				   
					<param name="number" expr="system.ANI"/> 
					<param name="ivr_menu" expr="''"/> 
					<param name="caller_id" expr="caller_id: _genesys.ixn.interactions[system.InteractionID].voice.connid"/>
				</session:fetch>
	  		</onentry>
			<transition event="session.fetch.done" cond="_event.data.requestid==App_restGetProfile['requestid']" target="$$_MY_PREFIX_$$.emsParseApiResult">
				<log expr="'Session FETCH  DONE'" />
				<log expr="'Composer Application:Main2 Block: restGetProfile'" />
				<log expr="'Data Fetched:' + _event.data.content" />
				<script>storeEvent("restGetProfile", _event);</script>
				<script>App_restGetProfile['data'] = eval('(' + _event.data.content + ')');</script>
				<assign location="httpResult" expr="App_restGetProfile['data']" />
				<log expr="'Data Assigned: ' + httpResult.toSource()"/>
				<assign location="apiCustomerValue" expr="true"/>
				<assign location="apiMemberType" expr="200"/>				
	    	</transition>
			<transition event="error" target="$$_MY_PREFIX_$$.emsParseEmergency">
				<log expr="'Composer Application: Main2 Block: restGetProfile'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("restGetProfile", _event);
				]]>
				</script>
				<assign location="apiMemberType" expr="_event.data.error == 0 ? undefined : _event.data.error"/>
				<assign location="apiCustomerValue" expr="false"/>
			</transition>
		</state>

		<!-- This is the emsAttachInitUData State -->
		<state id="emsAttachInitUData">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsAttachInitUData'"/>
				<log expr="'apiBlacklistType : ' + apiBlacklistType" level="2" />
				<script>
					(function(){
						try {
							// your code
							var v_kvlist = new Object();
					
							v_kvlist['cdpFirstName'] = apiFirstName;
							v_kvlist['cdpLastName'] = apiLastName;
							v_kvlist['cdpCompany'] = apiCompany;
							v_kvlist['cdpCustName'] = apiCustName;
							v_kvlist['cdpBlackListFlg'] = apiBlackListFlg;
							v_kvlist['cdpWhiteListFlg'] = apiWhiteListFlg;
							v_kvlist['cdpMemberType'] = apiMemberType;
							v_kvlist['cdpBlackListType'] = apiBlacklistType;
							v_kvlist['cdpCustomerValue'] = apiCustomerValue;
							v_kvlist['cdpSurveyTempId'] = apiSurveyTempId;		
							v_kvlist['cdpMessage'] = apiMessage;	
					
							v_kvlist['defaultLanguage'] = _data.defaultLanguage;
							v_kvlist['defaultMusic'] = _data.defaultMusic;
							v_kvlist['defaultMusicTimeout'] = _data.defaultMusicTimeout;
							v_kvlist['defaultPriority'] = _data.defaultPriority;
							v_kvlist['defaultTargetInfiniteTimeout'] = _data.defaultTargetInfiniteTimeout;
							v_kvlist['defaultTargetTimeout'] = _data.defaultTargetTimeout;
							v_kvlist['defaultSectionName'] = _data.defaultSectionName;
							v_kvlist['gaxAnncPath'] = _data.gaxAnncPath;
							v_kvlist['gaxARBaseURL'] = _data.gaxARBaseURL;
							v_kvlist['gaxMusicPath'] = _data.gaxMusicPath;
							v_kvlist['cdpApiBaseURL'] = _data.cdpApiBaseURL;
							v_kvlist['cdpAppKey'] = _data.cdpAppKey;
							v_kvlist['cdpSignin'] = _data.cdpSignin;
							v_kvlist['cdpSignoff'] = _data.cdpSignoff;
							v_kvlist['cdpGetDetailByPhone'] = _data.cdpGetDetailByPhone;
							v_kvlist['cdpCallJourney'] = _data.cdpCallJourney;
							v_kvlist['cdpEndCallSurveyURL'] = _data.cdpEndCallSurveyURL;
							v_kvlist['gnsEndCAllSurveyURL'] = _data.gnsEndCAllSurveyURL;
							v_kvlist['personality'] = _data.personality;
							v_kvlist['rpPGName'] = _data.rpPGName;
							v_kvlist['rpVQName'] = _data.rpVQName;
							
							v_kvlist['defaultSwitch'] = _data.defaultSwitch;
							v_kvlist['defaultStatServer'] = _data.defaultStatServer;
							v_kvlist['gvpIVRProfileMap'] = _data.gvpIVRProfileMap;
							v_kvlist['gvpRoutingTable'] = _data.gvpRoutingTable;
							
					
							_genesys.ixn.setuData(v_kvlist, system.InteractionID);
						
						} catch (error) {
							// error handling code
							alarmLog('exception inside emsAttachInitUData block: exception = ' + error);
						}
					})();
				</script>
				<send event="'emsAttachInitUData.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsAttachInitUData.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.bchIsBlackList">
				<script>storeEvent("emsAttachInitUData", _event);</script>
			</transition>
			<transition event="error" target="$$_MY_PREFIX_$$.RouteEmergency">
				<log expr="'Composer Application: Main2 Block: emsAttachInitUData'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("emsAttachInitUData", _event);
				]]>
				</script>
			</transition>
		</state>

		<!-- This is the bchIsBlackList State -->
		<state id="bchIsBlackList">
			<onentry>
				<log expr="_sessionid + ': Inside Branching Block: bchIsBlackList'" />
				<send event="'bchIsBlackList.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>				
			<transition event="bchIsBlackList.script.done" cond="apiBlackListFlg == 1" target="$$_MY_PREFIX_$$.Disconnect2">
			</transition>
			<transition event="bchIsBlackList.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.emsMapSvcCallFlow">
			</transition>
		</state>

		<!-- This is the emsReadGlobalParam State -->
		<state id="emsReadGlobalParam">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsReadGlobalParam'"/>
				<script>
					(function(){
					try {
						if (isEmpty(_data.globalListName)){
							_data.globalListName = 'GLOBAL_' + system.ThisDN + '_SETTING'
							__Log('###Initialize: Global Parameters list is undefined on Orchestration script. Automatically assigning OPM - ' + _data.globalListName);
						}
						else{
							__Log('###Initialize: Global Parameters list defined on Orchestration script, assigning  - ' + _data.globalListName);
						}
						
						try{
							__Log('###Initialize: ' + _data.globalListName + ' - ' + JSON.stringify(_data.globalListInfo));	
							_data.globalListInfo = _genesys.session.getListItemValue(_data.globalListName, 'OPM');
									
							 __Log('Initialize: read OPM Global param and save to project variables ' + _data.globalListName);
							
							__Log('Load CDP setting to variable');		
							 _data.cdpApiBaseURL=getValueFromListObject(_data.globalListInfo,'cdp_api_baseurl', '');
							 __Log('cdpApiBaseURL='+_data.cdpApiBaseURL);
							 
							 _data.cdpAppKey=getValueFromListObject(_data.globalListInfo,'cdp_app_key', '');
							 __Log('cdpAppKey='+_data.cdpAppKey);
							 
							 _data.cdpCallJourney=_data.cdpApiBaseURL + getValueFromListObject(_data.globalListInfo,'cdp_api_calljourney', '');
							 __Log('cdpCallJourney='+_data.cdpCallJourney);
							 
							 _data.cdpGetDetailByPhone=_data.cdpApiBaseURL + getValueFromListObject(_data.globalListInfo,'cdp_api_getdetailbyphone', '');
							 __Log('cdpGetDetailByPhone='+_data.cdpGetDetailByPhone);		 
							 
							 _data.cdpSignin=_data.cdpApiBaseURL + getValueFromListObject(_data.globalListInfo,'cdp_api_signin', '');
							 __Log('cdpSignin='+_data.cdpSignin);
							 
							 _data.cdpSignoff=_data.cdpApiBaseURL + getValueFromListObject(_data.globalListInfo,'cdp_api_signoff', '');
							__Log('cdpSignoff='+_data.cdpSignoff);
									
							_data.cdpEndCallSurveyURL=_data.cdpApiBaseURL + getValueFromListObject(_data.globalListInfo,'cdp_endcall_survey_url', '');
							__Log('cdpEndCallSurveyURL = '+_data.cdpEndCallSurveyURL);
							
							__Log('Load Callfow Default Setting');
							_data.gaxARBaseURL=getValueFromListObject(_data.globalListInfo,'default_arm_url', '');
							__Log('gaxARBaseURL = '+_data.gaxARBaseURL);
					
							_data.personality = getValueFromListObject(_data.globalListInfo,'default_personality', '');
							__Log('Personality = '+_data.gaxARBaseURL);
							
							_data.holiday=getValueFromListObject(_data.globalListInfo,'crd_holidays', '');
							 __Log('holiday = '+_data.holiday);		
							 		
							_data.gvpIVRProfileMap=getValueFromListObject(_data.globalListInfo,'gvp_svc_map', '');
							 __Log('gvpIVRProfileMapping = '+_data.gvpIVRProfileMap);				
							 
							__Log('Load Routing setting to variable');
							
							_data.gvpRoutingTable=getValueFromListObject(_data.globalListInfo,'gvp_routing_table', '');
							 __Log('gvp_routing_table = '+_data.gvpRoutingTable);				
					
							_data.defaultSwitch=getValueFromListObject(_data.globalListInfo,'default_switch_name', '');
							 __Log('defaultSwitch = '+_data.defaultSwitch);
							 
							_data.defaultStatServer=getValueFromListObject(_data.globalListInfo,'default_stat_server', '');
							 __Log('defaultStatServer = '+_data.defaultStatServer);
					
							 
						} catch( exception){
							__Log('###Could not read Global Parameters list - ' +  _data.globalListName +  '. ' + exception);
							 customLog('Initialize: OPM param with default value');
							 _data.cdpApiBaseURL='http://172.28.0.252/api';
							 _data.cdpAppKey='608608ed442341e78183358ace86971d';
							 _data.cdpCallJourney='callJournal';
							 _data.cdpGetDetailByPhone='getDetailbyPhoneKey';
							 _data.cdpSignin='';
							 _data.cdpSignoff='';
							_data.gaxARBaseURL='http://172.19.22.160/arm';
							_data.cdpEndCallSurveyURL='';
							_data.gvpIVRProfileMap='IVR_PROFILE_MAPPING';
							_data.gvpRoutingTable='GVP_ROUTING_TABLE';
							_data.defaultSwitch = 'SIP_Swtich_DC1';
							_data.defaultStatServer = 'Stat_Server_DC1';
									
							return;
						}
						
						// your code
					} catch (error) {
						// error handling code
							 customLog('Initialize: read OPM Global param and save to project variables ' + _data.globalListName);
							 _data.cdpApiBaseURL='http://172.19.22.157/api';
							 _data.cdpAppKey='608608ed442341e78183358ace86971d';
							 _data.cdpCallJourney='callJournal';
							 _data.cdpGetDetailByPhone='getDetailbyPhoneKey';
							 _data.cdpSignin='';
							 _data.cdpSignoff='';
							_data.gaxARBaseURL='http://172.19.22.160/arm';
							_data.cdpEndCallSurveyURL='';
							_data.gnsEndCAllSurveyURL='';
							_data.gvpIVRProfileMap='IVR_PROFILE_MAPPING';
							_data.gvpRoutingTable='GVP_ROUTING_TABLE';
							_data.defaultSwitch = 'SIP_Swtich_DC1';
							_data.defaultStatServer = 'Stat_Server_DC1';
							
					}
					
					})();
				</script>
				<send event="'emsReadGlobalParam.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsReadGlobalParam.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.emsJourneyBody01">
				<script>storeEvent("emsReadGlobalParam", _event);</script>
			</transition>
		</state>

		<!-- This is the emsMapSvcCallFlow State -->
		<state id="emsMapSvcCallFlow">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsMapSvcCallFlow'"/>
				<log expr="'_data.gvpIVRProfileMap - ' + _data.gvpIVRProfileMap" level="2" />
				<script>
					(function(){
					try {
						// your code	
						var now = new Date();
						const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
						var day = days[ now.getDay()];
					
						__Log('_data.gvpIVRProfileMap : ' + _data.gvpIVRProfileMap);
						var svchourlistobj = _genesys.session.getListItemValue(_data.gvpIVRProfileMap, 'ServiceHour');
						//__Log('Service Hour List :' + JSON.stringify(svchourlistobj));	
						
						var listobj = null;
						__Log('Check current is holiday from - '+_data.holiday);
						
						if (isHoliday(_data.holiday)){
							//Check Holiday
							var svchourholiday = getJSONContent(svchourlistobj, 'holiday');	
							var items = svchourholiday.split(',');
							//for (var item of  items) {
							for(var i=0; i&lt;items.length; i++){
								var item = items[i];
								
								var tokens = item.split('@');
								var sectionname = tokens[0];
								var timeRange = tokens[1];
								timeRange = timeRange.split('-');
								
								if (isCurrentTimeInRange(timeRange[0], timeRange[1])){
									listobj = _genesys.session.getListItemValue(_data.gvpIVRProfileMap, sectionname);
									break;
								}
							}
						} else {
							//Check Weekday
							var svchourday = getJSONContent(svchourlistobj, day);
							var items = svchourday.split(',');
							//for (String item of items){
							for(var i=0; i&lt;items.length; i++){
								var item = items[i];
										
								var tokens = item.split('@');
								var sectionname = tokens[0];
								var timeRange = tokens[1];
								timeRange = timeRange.split('-');
								
								if (isCurrentTimeInRange(timeRange[0], timeRange[1])){
									listobj = _genesys.session.getListItemValue(_data.gvpIVRProfileMap, sectionname);
									break;
								}
							}
						}
					
						__Log('List mapped serivce - ' + JSON.stringify(listobj));
						
						if (isEmpty(listobj)){
							listobj = _genesys.session.getListItemValue(_data.gvpIVRProfileMap, 'default');
						} 
						varPlayAppResource = getJSONContent(listobj, 'resource-url');
						varDefaultIVRProfile = getJSONContent(listobj, 'ivr-profile-name');
						playMainOpmName = getJSONContent(listobj, 'opm-name');
						
					} catch (error) {
						// error handling code
						__Log('@@@@@@ Exception Found - ' + error + ' @@@@@@');
					}
					
					})();
				</script>
				<send event="'emsMapSvcCallFlow.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsMapSvcCallFlow.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.emsSetMainParam">
				<script>storeEvent("emsMapSvcCallFlow", _event);</script>
			</transition>
			<transition event="error" target="$$_MY_PREFIX_$$.RouteEmergency">
				<log expr="'Composer Application: Main2 Block: emsMapSvcCallFlow'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("emsMapSvcCallFlow", _event);
				]]>
				</script>
			</transition>
		</state>

		<!-- This is the logAband State -->
		<state id="logAband">
			<onentry>
				<log expr="_sessionid + ': Inside Log Block: logAband'" />
				<log expr="'Call Abandoned Found!!!!!'" level="2" />
				<send event="'logAband.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="logAband.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.emsSetPayload3">
				<script>storeEvent("logAband", _event);</script>
			</transition>
		</state>

		<!-- This is the logIxnDelete State -->
		<state id="logIxnDelete">
			<onentry>
				<log expr="_sessionid + ': Inside Log Block: logIxnDelete'" />
				<log expr="'Ixn Delete Found!!!!!!!!!!'" level="2" />
				<send event="'logIxnDelete.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="logIxnDelete.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.emsSetPayload3">
				<script>storeEvent("logIxnDelete", _event);</script>
			</transition>
		</state>

		<!-- This is the emsParseEmergency State -->
		<state id="emsParseEmergency">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsParseEmergency'"/>
				<log expr="'httpResult - ' +JSON.stringify(httpResult)" level="2" />
				<script>
					(function(){
					try {
						// your code 00001
						__Log('### Initiate Call by Emergency Default Value');
						
						
						apiFirstName = 'Default';
						apiLastName = 'Emergency';
						apiCompany = 'n/a';
							
						apiSurveyTempId = 1;
						apiCustomerValue = 'n/a';
						
						apiBlacklistType = 'n/a';
						apiMemberType = 'general';
						apiBlackListFlg = 0;
						apiWhiteListFlg = 0;
						
						apiMessage = 'Emergency';
						
						apiCustName = apiFirstName + ' ' + apiLastName;
						
						__Log('### apiFirstName = '+apiFirstName);
						__Log('### apiLastName = '+apiLastName);
						__Log('### apiCompany = '+apiCompany);
						__Log('### apiSurveyTempId = '+apiSurveyTempId);
						__Log('### apiCustomerValue = '+apiCustomerValue);
						__Log('### apiBlacklistType = '+apiBlacklistType);
						__Log('### apiMemberType = '+apiMemberType);
						__Log('### apiBlackListFlg = '+apiBlackListFlg);
						__Log('### apiWhiteListFlg = '+apiWhiteListFlg);
						__Log('### apiMessage = '+apiMessage);
					
					
					} catch (err) {
						// error handling code
						__Log('@@@@@@ Exception Found - ' + err + '@@@@@@');
						throw new Error('Exception Found'); 
					}
					
					})();
				</script>
				<send event="'emsParseEmergency.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsParseEmergency.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.emsAttachInitUData">
				<script>storeEvent("emsParseEmergency", _event);</script>
			</transition>
		</state>

		<!-- This is the emsGetCallFlowValue State -->
		<state id="emsGetCallFlowValue">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsGetCallFlowValue'"/>
				<script>
					try {
							// your code
							__Log('IVR Last Menu - ' + outplayapp1);
							__Log('IVR Disconnect - ' + outplayapp2);
							
						} catch (error) {
							// error handling code
							outplayapp1 = 'M99';
							outplayapp2 = '0';
						}
				</script>
				<send event="'emsGetCallFlowValue.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsGetCallFlowValue.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.bchNextAction">
				<script>storeEvent("emsGetCallFlowValue", _event);</script>
			</transition>
			<transition event="error" target="$$_MY_PREFIX_$$.Assign1">
				<log expr="'Composer Application: Main2 Block: emsGetCallFlowValue'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("emsGetCallFlowValue", _event);
				]]>
				</script>
			</transition>
		</state>

		<!-- This is the emsGetRouteConfig State -->
		<state id="emsGetRouteConfig">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsGetRouteConfig'"/>
				<script>
					(function(){
					    try {
					        // your code	
					
							routeTimeout = _data.defaultTargetInfiniteTimeout;
							routePriority = _data.defaultPriority; 
					 		
					        __Log('outplayapp1 : ' + outplayapp1);
					        var routelistobj = _genesys.session.getListItemValue(_data.gvpRoutingTable, outplayapp1.toLowerCase());      
							if (isEmpty(routelistobj)){
								__Log('No Route Config for IVR Menu '+outplayapp1);
					            routelistobj = _genesys.session.getListItemValue(_data.gvpRoutingTable, 'default');
					            __Log('Load Default Route Config instead');
					        } else {
								__Log('Load Route Config for IVR Menu '+outplayapp1+'success');
					        }
					        
					        __Log('Routing List :' + JSON.stringify(routelistobj));	
					                
					        routeDestination = getJSONContent(routelistobj, 'route-destination');
					        routeBy = getJSONContent(routelistobj, 'routeby');
					        routeType = getJSONContent(routelistobj, 'routetype');
					        routeVQName = getJSONContent(routelistobj, 'virtual-queue-name');
					        //routeBusyAnncProfile = getJSONContent(routelistobj, ' busy-announcement-profile');
					        routeBusyTreatment = getJSONContent(routelistobj, 'busy-treatment');
					        __Log('routeBusyTreatment =&gt; ' + routeBusyTreatment);
					        routePreXferTreatement = getJSONContent(routelistobj, 'pre-transfer-treatment');
					        __Log('routePreXferTreatement =&gt; ' + routePreXferTreatement);
					        
					        switch (routeType.toLowerCase()) {
					        	case 'gns':
					        		routeTargetExpr = routeDestination+'@' + _data.defaultStatServer + '.GA';
					        		break;
					        	case 'lg':
					        		routeDestination = routeDestination;
					        		//routeDestination = '9980877915499'
					        		routeTargetExpr = routeDestination + '@' + _data.defaultSwitch + '.DN';
					        		break;
					        	case 'nt':
					        		routeDestination = routeDestination;
					        		routeTargetExpr = routeDestination + '@' + _data.defaultSwitch + '.DN';
					        		break;
					        	default:
					       }
					    } catch (error) {
					        // error handling code
					        __Log('@@@@@@ Exception Found - ' + error + ' @@@@@@');
					
							__Log('Load Default Route Config instead');
							var routelistobj = _genesys.session.getListItemValue(_data.gvpRoutingTable, 'default');
					
							if (isEmpty(routelistobj)){
								__Log('No Default Route Config. Set default value instead');
					    	    routeDestination = 'GHB_ALL_AGENT';
						        routeBy = 'agent-group';
					        	routeType = 'gns';
					    	    routeVQName = 'VQ_NGCC_ALL_AGENT';
						
						        routeBusyTreatment = 'DEFAULT_BUSY_TREATMENT';
					        	__Log('routeBusyTreatment =&gt; ' + routeBusyTreatment);
					    	    routePreXferTreatement = 'DEFAULT_PRE-XFER_TREATMENT';
						        __Log('routePreXferTreatement =&gt; ' + routePreXferTreatement);
					
								routeTargetExpr = routeDestination+'@' + _data.defaultStatServer + '.GA';
					        } else {
								__Log('Load Default Route Config success');
					
					        	__Log('Routing List :' + JSON.stringify(routelistobj));	
					                
					    	    routeDestination = getJSONContent(routelistobj, 'route-destination');
						        routeBy = getJSONContent(routelistobj, 'routeby');
					        	routeType = getJSONContent(routelistobj, 'routetype');
					    	    routeVQName = getJSONContent(routelistobj, 'virtual-queue-name');
						
						        routeBusyTreatment = getJSONContent(routelistobj, 'busy-treatment');
					        	__Log('routeBusyTreatment =&gt; ' + routeBusyTreatment);
					    	    routePreXferTreatement = getJSONContent(routelistobj, 'pre-transfer-treatment');
						        __Log('routePreXferTreatement =&gt; ' + routePreXferTreatement);
					
						        
						        switch (routeType.toLowerCase()) {
						        	case 'gns':
					        			routeTargetExpr = routeDestination+'@' + _data.defaultStatServer + '.GA';
					    	    		break;
						        	case 'lg':
					        			routeTargetExpr = routeDestination + '@' + _data.defaultSwitch + '.DN';
					    	    		break;
						        	case 'nt':
					        			routeTargetExpr = routeDestination + '@' + _data.defaultSwitch + '.DN';
					        			break;
					    	    	default:
								}
					        }
					    }
					})();
				</script>
				<send event="'emsGetRouteConfig.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsGetRouteConfig.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.bchIsPreXferEnable">
				<script>storeEvent("emsGetRouteConfig", _event);</script>
			</transition>
			<transition event="error" target="$$_MY_PREFIX_$$.SetRouteHint">
				<log expr="'Composer Application: Main2 Block: emsGetRouteConfig'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("emsGetRouteConfig", _event);
				]]>
				</script>
			</transition>
		</state>

		<!-- This is the bchRouteType State -->
		<state id="bchRouteType">
			<onentry>
				<log expr="_sessionid + ': Inside Branching Block: bchRouteType'" />
				<send event="'bchRouteType.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>				
			<transition event="bchRouteType.script.done" cond="routeType.toLowerCase() === 'gns'" target="$$_MY_PREFIX_$$.bchCheckNPA">
			</transition>				
			<transition event="bchRouteType.script.done" cond="routeType.toLowerCase() === 'lg'" target="$$_MY_PREFIX_$$.forceLG">
			</transition>				
			<transition event="bchRouteType.script.done" cond="routeType.toLowerCase() === 'nt'" target="$$_MY_PREFIX_$$.forceRouteNT">
			</transition>
			<transition event="bchRouteType.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.TargetBySkill1">
			</transition>
		</state>

		<!-- This is the forceRouteNT State -->
		<state id="forceRouteNT">
			<initial>
				<transition target="$$_MY_PREFIX_$$._reserved_forceRouteNT_redirect">
					<log expr="'Inside ForceRoute Block: forceRouteNT '"/>
				</transition>
			</initial>
			<state id="_reserved_forceRouteNT_redirect">
				<onentry>
					<script>
						var App_hints = varRouteHint;
					</script>
					<ixn:redirect detach="true" requestid="App_forceRouteNT['requestid']" interactionid="system.InteractionID" from="system.ThisDN" to="routeDestination" hints="App_hints" type="_genesys.queue.rType.RouteTypeDefault"/>
				</onentry>
			<transition event="interaction.redirect.done" cond="_event.data.requestid==App_forceRouteNT['requestid']" target="$$_MY_PREFIX_$$.emsSetPayload4">
				<script>storeEvent("forceRouteNT", _event);</script>
				<assign location="App_forceRouteNT['interaction.redirect.requestid']" expr="_event.data.requestid"/>
			</transition>
			</state>
		</state>

		<!-- This is the RouteEmergency State -->
		<state id="RouteEmergency">
						
			<initial>
				<transition target="$$_MY_PREFIX_$$._reserved_RouteEmergency_submit">
					<log expr="_sessionid + ': Inside Target Block: RouteEmergency '"/>
				<log expr="'varSkillExpr - ' + varSkillExpr" level="2" />
				</transition>
			</initial>
			
			<state id="_reserved_RouteEmergency_submit">
				<onentry>
					<queue:submit route="false" requestid="App_RouteEmergency['requestid']" interactionid="system.InteractionID" queue="routeVQName" timeout="toNumber(_data.defaultTargetTimeout)" clearontimeout="true" ordertype="'max'" orderstat="'StatAgentLoading'">
						<queue:targets>
							<queue:target name="'AG_CALL_NEXT_GEN'" type="agentgroup" statserver="'Stat_Server_DC1'"/>						
						</queue:targets>
					</queue:submit>
				</onentry>
				<transition event="queue.submit.requestid" cond="_event.data.requestid==App_RouteEmergency['requestid']">
					<script>storeEvent("RouteEmergency", _event);</script>
					<assign location="App_RouteEmergency['queue.submit.requestid']" expr="_event.data.requestid"/>
					<assign location="system.LastSubmitRequestId" expr="_event.data.requestid"/>
					<assign location="varReqId" expr="_event.data.requestid"/>
				</transition>
				<transition event="queue.submit.done" cond="_event.data.requestid==App_RouteEmergency['requestid']" target="$$_MY_PREFIX_$$._reserved_RouteEmergency_fetch_deviation">
					<log expr="'Target Selection DONE'" />
					<log expr="'Composer Application:Main2 Block: RouteEmergency'" />
					<log expr="'Target selected:' + _event.data.targetselected" />
					<if cond="typeof system.InteractionID != 'undefined' &amp;&amp; system.InteractionID != null &amp;&amp; _genesys.ixn.interactions[system.InteractionID] != null &amp;&amp; typeof _genesys.ixn.interactions[system.InteractionID] != 'undefined' &amp;&amp; typeof _genesys.ixn.interactions[system.InteractionID].voice != 'undefined'">
						<log expr="'_genesys.ixn.interactions[system.InteractionID].voice.ani: ' + _genesys.ixn.interactions[system.InteractionID].voice.ani" />
						<log expr="'_genesys.ixn.interactions[system.InteractionID].ani: ' + _genesys.ixn.interactions[system.InteractionID].ani" />
					<else/>
						<log expr="'Interaction is null'" />
					</if>
					<script>storeEvent("RouteEmergency", _event);</script>
					<assign location="system.LastTargetComponentSelected" expr="_event.data.targetcomponentselected"/>
					<assign location="system.LastTargetObjectSelected" expr="_event.data.targetobjectselected"/>
					<assign location="system.LastTargetSelected" expr="_event.data.targetselected"/>
					<assign location="system.LastVirtualQueueSelected" expr="_event.data.vqselected"/>
					<assign location="App_RouteEmergency['targetResource']" expr="_event.data.resource"/>
					</transition>
			</state>
			<state id="_reserved_RouteEmergency_submit_delay">
				<onentry>
					<send event="'RouteEmergency.aftersubmit.timeout.elapsed'" delay="'200ms'">
					<param name="resolveid" expr="_my_prefix"/>
					</send>
				</onentry>
				<transition event="RouteEmergency.aftersubmit.timeout.elapsed" cond="_event.data.resolveid == _my_prefix" target="$$_MY_PREFIX_$$._reserved_RouteEmergency_detach"/>
			</state>
			<state id="_reserved_RouteEmergency_detach" initial="$$_MY_PREFIX_$$._reserved_RouteEmergency_detach_run">
				<onentry>
					<log expr="'Detach the interaction ' + system.InteractionID"/>
					<script>var App_RouteEmergency_Detach_Timeout = new Date().getTime() + 300;</script>
				</onentry>
				<state id="_reserved_RouteEmergency_detach_run">
					<onentry>
						<log expr="'Detach attempt for interaction ' + system.InteractionID"/>
						<ixn:detach interactionid="system.InteractionID" requestid="App_RouteEmergency['requestid']"/>
					</onentry>
					<transition event="interaction.detach.done" cond="_event.data.requestid==App_RouteEmergency['requestid']" target="$$_MY_PREFIX_$$._reserved_RouteEmergency_redirect">
						<script>storeEvent("RouteEmergency", _event);</script>
				<assign location="App_RouteEmergency['interaction.detach.requestid']" expr="_event.data.requestid"/>
					</transition>
					<transition event="error.interaction.detach" cond="(_event.data.requestid==App_RouteEmergency['requestid']) &amp;&amp; (_event.data.error=='invalidstate') &amp;&amp; ((new Date().getTime() + 200) &lt; App_RouteEmergency_Detach_Timeout)" target="$$_MY_PREFIX_$$._reserved_RouteEmergency_detach_delay"/>
				</state>
				<state id="_reserved_RouteEmergency_detach_delay">
					<onentry>
						<send event="'RouteEmergency.afterdetach.timeout.elapsed'" delay="'200ms'"/>
					</onentry>
					<transition event="RouteEmergency.afterdetach.timeout.elapsed" target="$$_MY_PREFIX_$$._reserved_RouteEmergency_detach_run"/>
				</state>
			</state>
			<state id="_reserved_RouteEmergency_attach">
				<onentry>
					<log expr="'Attach the interaction back'" />
					<ixn:attach interactionid="system.InteractionID" requestid="App_RouteEmergency['requestid']"/>
				</onentry>
				<transition event="interaction.attach.done" cond="_event.data.requestid==App_RouteEmergency['requestid']">
					<script>storeEvent("RouteEmergency", _event);</script>
				<assign location="App_RouteEmergency['interaction.attach.requestid']" expr="_event.data.requestid"/>
					<script>
						App_RouteEmergency['requestid'] = App_RouteEmergency['error.rethrow'].params.requestid;
						__Raise(App_RouteEmergency['error.rethrow'].name, App_RouteEmergency['error.rethrow'].params);
					</script>
				</transition>
			</state>
			<state id="_reserved_RouteEmergency_fetch_deviation">
				<transition target="$$_MY_PREFIX_$$._reserved_RouteEmergency_redirect">
					<log expr="_sessionid + ': Target Deviation from Ideal Agent'" />
				</transition>
			</state>
			<state id="_reserved_RouteEmergency_redirect">
				<onentry>
					<log expr="_sessionid + ': Inside Target Redirect: RouteEmergency '" />
					<ixn:redirect detach="true" requestid="App_RouteEmergency['requestid']" interactionid="system.InteractionID" from="system.ThisDN" to="App_RouteEmergency['targetResource']" type="_genesys.queue.rType.RouteTypeDefault" hints="{}"/>
				</onentry>
			<transition event="interaction.redirect.done" cond="_event.data.requestid==App_RouteEmergency['requestid']" target="$$_MY_PREFIX_$$.emsSetPayload4">
				<script>storeEvent("RouteEmergency", _event);</script>
				<assign location="App_RouteEmergency['interaction.redirect.requestid']" expr="_event.data.requestid"/>
			</transition>
				
			</state>
		</state>

		<!-- This is the postJourneyEnd State -->
		<state id="postJourneyEnd">
			<onentry>
			    <log expr="_sessionid + ': Inside HTTPRest Block: postJourneyEnd'" />

				<script>
				 var customHeaders = new Object();
				 customHeaders["apiKey"] = _data.cdpAppKey;
    			</script>
				<session:fetch requestid="App_postJourneyEnd['requestid']"
					       srcexpr="_data.cdpCallJourney" method="'post'" enctype="'application/json'" maxage="0"
					       maxstale="0" type="'application/json'" gdelivery="false" 
					       gd_retries="1" gd_retry_interval="0" timeout="10" headers="customHeaders">
				   <content _expr="apiBodyPayload"/>
				</session:fetch>
	  		</onentry>
			<transition event="session.fetch.done" cond="_event.data.requestid==App_postJourneyEnd['requestid']" target="$$_MY_PREFIX_$$.Exit1">
				<log expr="'Session FETCH  DONE'" />
				<log expr="'Composer Application:Main2 Block: postJourneyEnd'" />
				<log expr="'Data Fetched:' + _event.data.content" />
				<script>storeEvent("postJourneyEnd", _event);</script>
				<script>App_postJourneyEnd['data'] = eval('(' + _event.data.content + ')');</script>
				<assign location="httpResult" expr="App_postJourneyEnd['data']" />
				<log expr="'Data Assigned: ' + httpResult.toSource()"/>
				<assign location="apiCustomerValue" expr="true"/>
				<assign location="apiMemberType" expr="200"/>				
	    	</transition>
			<transition event="error" target="$$_MY_PREFIX_$$.Exit1">
				<log expr="'Composer Application: Main2 Block: postJourneyEnd'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("postJourneyEnd", _event);
				]]>
				</script>
				<assign location="apiMemberType" expr="_event.data.error == 0 ? undefined : _event.data.error"/>
				<assign location="apiCustomerValue" expr="false"/>
			</transition>
		</state>

		<!-- This is the emsSetPayload3 State -->
		<state id="emsSetPayload3">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsSetPayload3'"/>
				<script>
					(function(){
					try {
						// your code
					//	var bodypayload = { call_type: &quot;Inbound&quot;, date_time: getCurrentDateTimeStr(), description : &quot;Flow End [IVR Hangup]&quot;,  
					//										number: system.ANI, name: &quot;ivr&quot;, agent: &quot;ivr&quot;, duration: &quot;0&quot;, ivr_menu: outplayapp1,
					//										caller_id: _genesys.ixn.interactions[system.InteractionID].voice.connid  };			
					
						apiBodyPayload = { call_type: &quot;Inbound&quot;, date_time: getCurrentDateTimeStr(), description : &quot;Flow End [Release by Customer]&quot;,  
															number: system.ANI, name: &quot;ivr&quot;, agent: &quot;ivr&quot;, duration: &quot;0&quot;, ivr_menu: outplayapp1,
															caller_id: _genesys.ixn.interactions[system.InteractionID].voice.connid  };
					
						__Log('########## CallJourney payload - Flow End - ' + JSON.stringify(apiBodyPayload));
					} catch (error) {
						// error handling code
							__Log('@@@@@@@@@@: Set CallJourney payload fail - ' + error);		
							return;
					}
					
					})();
				</script>
				<send event="'emsSetPayload3.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsSetPayload3.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.postJourneyEnd">
				<script>storeEvent("emsSetPayload3", _event);</script>
			</transition>
		</state>

		<!-- This is the emsSetPayload4 State -->
		<state id="emsSetPayload4">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsSetPayload4'"/>
				<script>
					(function(){
					try {
						// your code
					//	var bodypayload = { call_type: &quot;Inbound&quot;, date_time: getCurrentDateTimeStr(), description : &quot;Flow End [IVR Hangup]&quot;,  
					//										number: system.ANI, name: &quot;ivr&quot;, agent: &quot;ivr&quot;, duration: &quot;0&quot;, ivr_menu: outplayapp1,
					//										caller_id: _genesys.ixn.interactions[system.InteractionID].voice.connid  };			
					
						apiBodyPayload = { call_type: &quot;Inbound&quot;, date_time: getCurrentDateTimeStr(), description : &quot;Flow End [Transfer Customer]&quot;,  
															number: system.ANI, name: &quot;ivr&quot;, agent: &quot;ivr&quot;, duration: &quot;0&quot;, ivr_menu: outplayapp1,
															caller_id: _genesys.ixn.interactions[system.InteractionID].voice.connid  };
					
						__Log('########## CallJourney payload - Flow End - ' + JSON.stringify(apiBodyPayload));
					} catch (error) {
						// error handling code
							__Log('@@@@@@@@@@: Set CallJourney payload fail - ' + error);		
							return;
					}
					
					})();
				</script>
				<send event="'emsSetPayload4.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsSetPayload4.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.postJourneyEnd">
				<script>storeEvent("emsSetPayload4", _event);</script>
			</transition>
		</state>

		<!-- This is the postJourneyStart01 State -->
		<state id="postJourneyStart01">
			<onentry>
			    <log expr="_sessionid + ': Inside HTTPRest Block: postJourneyStart01'" />
				<log expr="'Body Payload - ' + apiBodyPayload" level="2" />
				<log expr="'Request Url - ' + _data.cdpCallJourney" level="2" />

				<script>
				 var customHeaders = new Object();
				 customHeaders["apiKey"] = _data.cdpAppKey;
    			</script>
				<session:fetch requestid="App_postJourneyStart01['requestid']"
					       srcexpr="_data.cdpCallJourney" method="'post'" enctype="'application/json'" maxage="0"
					       maxstale="0" type="'application/json'" gdelivery="false" 
					       gd_retries="1" gd_retry_interval="0" timeout="10" headers="customHeaders">
				   <content _expr="apiBodyPayload"/>
				</session:fetch>
	  		</onentry>
			<transition event="session.fetch.done" cond="_event.data.requestid==App_postJourneyStart01['requestid']" target="$$_MY_PREFIX_$$.restGetProfile">
				<log expr="'Session FETCH  DONE'" />
				<log expr="'Composer Application:Main2 Block: postJourneyStart01'" />
				<log expr="'Data Fetched:' + _event.data.content" />
				<script>storeEvent("postJourneyStart01", _event);</script>
				<script>App_postJourneyStart01['data'] = eval('(' + _event.data.content + ')');</script>
				<assign location="httpResult" expr="App_postJourneyStart01['data']" />
				<log expr="'Data Assigned: ' + httpResult.toSource()"/>
				<assign location="httpResponseStatus" expr="true"/>
				<assign location="httpStatusCode" expr="200"/>				
	    	</transition>
			<transition event="error" target="$$_MY_PREFIX_$$.restGetProfile">
				<log expr="'Composer Application: Main2 Block: postJourneyStart01'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("postJourneyStart01", _event);
				]]>
				</script>
				<assign location="httpStatusCode" expr="_event.data.error == 0 ? undefined : _event.data.error"/>
				<assign location="httpResponseStatus" expr="false"/>
			</transition>
		</state>

		<!-- This is the emsJourneyBody01 State -->
		<state id="emsJourneyBody01">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsJourneyBody01'"/>
				<script>
					(function(){
					try {
						// your code
					//	var bodypayload = { call_type: &quot;Inbound&quot;, date_time: now, description : &quot;Flow Begin&quot;,  
					//										number: system.ANI, name: &quot;ivr&quot;, agent: &quot;ivr&quot;, duration: &quot;0&quot;, ivr_menu: &quot;FlowEntry&quot;,
					//										caller_id: _genesys.ixn.interactions[system.InteractionID].voice.connid  };
					
						apiBodyPayload = { call_type: &quot;Inbound&quot;, date_time: getCurrentDateTimeStr(), description : &quot;Flow Begin&quot;,  
															number: system.ANI, name: &quot;ivr&quot;, agent: &quot;ivr&quot;, duration: &quot;0&quot;, ivr_menu: &quot;Workflow&quot;,
															caller_id: _genesys.ixn.interactions[system.InteractionID].voice.connid  };
					
						__Log('########## CallJourney payload - Flow Begin - ' + JSON.stringify(apiBodyPayload));
					} catch (error) {
						// error handling code
							__Log('@@@@@@@@@@: Se CallJourney payload fail - ' + error);		
							return;
					}
					
					})();
				</script>
				<send event="'emsJourneyBody01.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsJourneyBody01.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.postJourneyStart01">
				<script>storeEvent("emsJourneyBody01", _event);</script>
			</transition>
			<transition event="error" target="$$_MY_PREFIX_$$.restGetProfile">
				<log expr="'Composer Application: Main2 Block: emsJourneyBody01'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("emsJourneyBody01", _event);
				]]>
				</script>
			</transition>
		</state>

		<!-- This is the Assign1 State -->
		<state id="Assign1">
			<onentry>
				<log expr="_sessionid + ': Inside Assign Block: Assign1'" />
				<script>
					outplayapp1 = 'unknown';					
						
					outplayapp2 = 'AG_NGCC_ALL';					
						
					outplayapp3 = 'unknown';					
						
				</script>
				<send event="'Assign1.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="Assign1.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.bchNextAction">
				<script>storeEvent("Assign1", _event);</script>
			</transition>
		</state>

		<!-- This is the bchNextAction State -->
		<state id="bchNextAction">
			<onentry>
				<log expr="_sessionid + ': Inside Branching Block: bchNextAction'" />
				<send event="'bchNextAction.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>				
			<transition event="bchNextAction.script.done" cond="outplayapp2 == '1'" target="$$_MY_PREFIX_$$.emsSetPayload2">
			</transition>
			<transition event="bchNextAction.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.emsGetRouteConfig">
			</transition>
		</state>

		<!-- This is the postJourneyEnd4 State -->
		<state id="postJourneyEnd4">
			<onentry>
			    <log expr="_sessionid + ': Inside HTTPRest Block: postJourneyEnd4'" />

				<script>
				 var customHeaders = new Object();
				 customHeaders["apiKey"] = _data.cdpAppKey;
    			</script>
				<session:fetch requestid="App_postJourneyEnd4['requestid']"
					       srcexpr="_data.cdpCallJourney" method="'post'" enctype="'application/json'" maxage="0"
					       maxstale="0" type="'application/json'" gdelivery="false" 
					       gd_retries="1" gd_retry_interval="0" timeout="10" headers="customHeaders">
				   <content _expr="apiBodyPayload"/>
				</session:fetch>
	  		</onentry>
			<transition event="session.fetch.done" cond="_event.data.requestid==App_postJourneyEnd4['requestid']" target="$$_MY_PREFIX_$$.Disconnect3">
				<log expr="'Session FETCH  DONE'" />
				<log expr="'Composer Application:Main2 Block: postJourneyEnd4'" />
				<log expr="'Data Fetched:' + _event.data.content" />
				<script>storeEvent("postJourneyEnd4", _event);</script>
				<script>App_postJourneyEnd4['data'] = eval('(' + _event.data.content + ')');</script>
				<assign location="httpResult" expr="App_postJourneyEnd4['data']" />
				<log expr="'Data Assigned: ' + httpResult.toSource()"/>
				<assign location="apiCustomerValue" expr="true"/>
				<assign location="apiMemberType" expr="200"/>				
	    	</transition>
			<transition event="error" target="$$_MY_PREFIX_$$.Disconnect3">
				<log expr="'Composer Application: Main2 Block: postJourneyEnd4'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("postJourneyEnd4", _event);
				]]>
				</script>
				<assign location="apiMemberType" expr="_event.data.error == 0 ? undefined : _event.data.error"/>
				<assign location="apiCustomerValue" expr="false"/>
			</transition>
		</state>

		<!-- This is the emsSetPayload2 State -->
		<state id="emsSetPayload2">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsSetPayload2'"/>
				<script>
					(function(){
					try {
						// your code
					//	var bodypayload = { call_type: &quot;Inbound&quot;, date_time: getCurrentDateTimeStr(), description : &quot;Flow End [IVR Hangup]&quot;,  
					//										number: system.ANI, name: &quot;ivr&quot;, agent: &quot;ivr&quot;, duration: &quot;0&quot;, ivr_menu: outplayapp1,
					//										caller_id: _genesys.ixn.interactions[system.InteractionID].voice.connid  };			
					
						apiBodyPayload = { call_type: &quot;Inbound&quot;, date_time: getCurrentDateTimeStr(), description : &quot;Flow End [IVR Release]&quot;,  
															number: system.ANI, name: &quot;ivr&quot;, agent: &quot;ivr&quot;, duration: &quot;0&quot;, ivr_menu: outplayapp1,
															caller_id: _genesys.ixn.interactions[system.InteractionID].voice.connid  };
					
						__Log('########## CallJourney payload - Flow End - ' + JSON.stringify(apiBodyPayload));
					} catch (error) {
						// error handling code
							__Log('@@@@@@@@@@: Set CallJourney payload fail - ' + error);		
							return;
					}
					
					})();
				</script>
				<send event="'emsSetPayload2.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsSetPayload2.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.postJourneyEnd4">
				<script>storeEvent("emsSetPayload2", _event);</script>
			</transition>
		</state>

		<!-- This is the Disconnect3 State -->
		<final id="Disconnect3">
			<onentry>
				<log expr="_sessionid + ': Inside Disconnect Block: Disconnect3'" />
				<ixn:terminate requestid="App_Disconnect3['requestid']" interactionid="system.InteractionID" reason="'Disconnect interaction'"/>
			</onentry>
		</final>

		<!-- This is the emsAttachIDCard State -->
		<state id="emsAttachIDCard">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsAttachIDCard'"/>
				<log expr="'outplayapp1 : ' + outplayapp1" level="2" />
				<log expr="'outplayapp2 : ' + outplayapp2" level="2" />
				<log expr="'outplayapp3 : ' + outplayapp3" level="2" />
				<script>
					(function(){
					try {
						var v_kvlist = new Object();
						v_kvlist['IDCardNo'] = outplayapp3;
						v_kvlist['IVRLastMenu'] = outplayapp1;
						v_kvlist['DestQueue']=routeVQName;
						_genesys.ixn.setuData(v_kvlist, system.InteractionID);
						
					} catch (error) {
						// error handling code
							__Log('###SaveJourney: Could not save call journey - ' + error);		
							return;
					}
					
					})();
				</script>
				<send event="'emsAttachIDCard.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsAttachIDCard.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.SetRouteHint">
				<script>storeEvent("emsAttachIDCard", _event);</script>
			</transition>
		</state>

		<!-- This is the TargetByCPDAG State -->
		<state id="TargetByCPDAG">
						
			<initial>
				<transition target="$$_MY_PREFIX_$$._reserved_TargetByCPDAG_submit">
					<log expr="_sessionid + ': Inside Target Block: TargetByCPDAG '"/>
				<log expr="'varSkillExpr - ' + varSkillExpr" level="2" />
				</transition>
			</initial>
			
			<state id="_reserved_TargetByCPDAG_submit">
				<onentry>
					<queue:submit route="false" requestid="App_TargetByCPDAG['requestid']" interactionid="system.InteractionID" queue="routeVQName" timeout="toNumber(routeTargetTimeout)" priority="toNumber(routePriority)" clearontimeout="true" ordertype="'max'" orderstat="'StatAgentLoading'">
						<dialog:runtreatments>
							<!-- Busy treatment code is generated based on treatment blocks connected to this Target block -->	
				<!-- papBusyAnncCRD busy treatment block -->
				<dialog:start type="'applid'" interactionid="system.InteractionID" requestid="App_TargetByCPDAG['treatmentrequestid']">
					<param name="APP_URI" expr="system.RelativePathURL+'src-gen/subBusyAnncCRD.vxml'" />
    				<param name="LANGUAGE" expr="'English (US)'" />
				</dialog:start>
						</dialog:runtreatments>
						<queue:targets>
							<queue:targetid expr="routeTargetExpr"/>						
						</queue:targets>
					</queue:submit>
				</onentry>
				<transition event="queue.submit.requestid" cond="_event.data.requestid==App_TargetByCPDAG['requestid']">
					<script>storeEvent("TargetByCPDAG", _event);</script>
					<assign location="App_TargetByCPDAG['queue.submit.requestid']" expr="_event.data.requestid"/>
					<assign location="system.LastSubmitRequestId" expr="_event.data.requestid"/>
					<assign location="varReqId" expr="_event.data.requestid"/>
				</transition>
				<transition event="queue.submit.done" cond="_event.data.requestid==App_TargetByCPDAG['requestid']" target="$$_MY_PREFIX_$$._reserved_TargetByCPDAG_fetch_deviation">
					<log expr="'Target Selection DONE'" />
					<log expr="'Composer Application:Main2 Block: TargetByCPDAG'" />
					<log expr="'Target selected:' + _event.data.targetselected" />
					<if cond="typeof system.InteractionID != 'undefined' &amp;&amp; system.InteractionID != null &amp;&amp; _genesys.ixn.interactions[system.InteractionID] != null &amp;&amp; typeof _genesys.ixn.interactions[system.InteractionID] != 'undefined' &amp;&amp; typeof _genesys.ixn.interactions[system.InteractionID].voice != 'undefined'">
						<log expr="'_genesys.ixn.interactions[system.InteractionID].voice.ani: ' + _genesys.ixn.interactions[system.InteractionID].voice.ani" />
						<log expr="'_genesys.ixn.interactions[system.InteractionID].ani: ' + _genesys.ixn.interactions[system.InteractionID].ani" />
					<else/>
						<log expr="'Interaction is null'" />
					</if>
					<script>storeEvent("TargetByCPDAG", _event);</script>
					<assign location="system.LastTargetComponentSelected" expr="_event.data.targetcomponentselected"/>
					<assign location="system.LastTargetObjectSelected" expr="_event.data.targetobjectselected"/>
					<assign location="system.LastTargetSelected" expr="_event.data.targetselected"/>
					<assign location="system.LastVirtualQueueSelected" expr="_event.data.vqselected"/>
					<assign location="App_TargetByCPDAG['targetResource']" expr="_event.data.resource"/>
					</transition>
			</state>
			<state id="_reserved_TargetByCPDAG_submit_delay">
				<onentry>
					<send event="'TargetByCPDAG.aftersubmit.timeout.elapsed'" delay="'200ms'">
					<param name="resolveid" expr="_my_prefix"/>
					</send>
				</onentry>
				<transition event="TargetByCPDAG.aftersubmit.timeout.elapsed" cond="_event.data.resolveid == _my_prefix" target="$$_MY_PREFIX_$$._reserved_TargetByCPDAG_detach"/>
			</state>
			<state id="_reserved_TargetByCPDAG_detach" initial="$$_MY_PREFIX_$$._reserved_TargetByCPDAG_detach_run">
				<onentry>
					<log expr="'Detach the interaction ' + system.InteractionID"/>
					<script>var App_TargetByCPDAG_Detach_Timeout = new Date().getTime() + 300;</script>
				</onentry>
				<state id="_reserved_TargetByCPDAG_detach_run">
					<onentry>
						<log expr="'Detach attempt for interaction ' + system.InteractionID"/>
						<ixn:detach interactionid="system.InteractionID" requestid="App_TargetByCPDAG['requestid']"/>
					</onentry>
					<transition event="interaction.detach.done" cond="_event.data.requestid==App_TargetByCPDAG['requestid']" target="$$_MY_PREFIX_$$._reserved_TargetByCPDAG_redirect">
						<script>storeEvent("TargetByCPDAG", _event);</script>
				<assign location="App_TargetByCPDAG['interaction.detach.requestid']" expr="_event.data.requestid"/>
					</transition>
					<transition event="error.interaction.detach" cond="(_event.data.requestid==App_TargetByCPDAG['requestid']) &amp;&amp; (_event.data.error=='invalidstate') &amp;&amp; ((new Date().getTime() + 200) &lt; App_TargetByCPDAG_Detach_Timeout)" target="$$_MY_PREFIX_$$._reserved_TargetByCPDAG_detach_delay"/>
				</state>
				<state id="_reserved_TargetByCPDAG_detach_delay">
					<onentry>
						<send event="'TargetByCPDAG.afterdetach.timeout.elapsed'" delay="'200ms'"/>
					</onentry>
					<transition event="TargetByCPDAG.afterdetach.timeout.elapsed" target="$$_MY_PREFIX_$$._reserved_TargetByCPDAG_detach_run"/>
				</state>
			</state>
			<state id="_reserved_TargetByCPDAG_attach">
				<onentry>
					<log expr="'Attach the interaction back'" />
					<ixn:attach interactionid="system.InteractionID" requestid="App_TargetByCPDAG['requestid']"/>
				</onentry>
				<transition event="interaction.attach.done" cond="_event.data.requestid==App_TargetByCPDAG['requestid']">
					<script>storeEvent("TargetByCPDAG", _event);</script>
				<assign location="App_TargetByCPDAG['interaction.attach.requestid']" expr="_event.data.requestid"/>
					<script>
						App_TargetByCPDAG['requestid'] = App_TargetByCPDAG['error.rethrow'].params.requestid;
						__Raise(App_TargetByCPDAG['error.rethrow'].name, App_TargetByCPDAG['error.rethrow'].params);
					</script>
				</transition>
			</state>
			<state id="_reserved_TargetByCPDAG_fetch_deviation">
				<transition target="$$_MY_PREFIX_$$._reserved_TargetByCPDAG_redirect">
					<log expr="_sessionid + ': Target Deviation from Ideal Agent'" />
				</transition>
			</state>
			<state id="_reserved_TargetByCPDAG_redirect">
				<onentry>
					<log expr="_sessionid + ': Inside Target Redirect: TargetByCPDAG '" />
					<ixn:redirect detach="true" requestid="App_TargetByCPDAG['requestid']" interactionid="system.InteractionID" from="system.ThisDN" to="App_TargetByCPDAG['targetResource']" type="_genesys.queue.rType.RouteTypeDefault" hints="varRouteHint"/>
				</onentry>
			<transition event="interaction.redirect.done" cond="_event.data.requestid==App_TargetByCPDAG['requestid']" target="$$_MY_PREFIX_$$.emsSetPayload4">
				<script>storeEvent("TargetByCPDAG", _event);</script>
				<assign location="App_TargetByCPDAG['interaction.redirect.requestid']" expr="_event.data.requestid"/>
			</transition>
				
			</state>
			<transition event="error.queue.submit" cond="_event.data.requestid==App_TargetByCPDAG['requestid']" target="$$_MY_PREFIX_$$.weWait1Sec">
				<log expr="'Composer Application: Main2 Block: TargetByCPDAG'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("TargetByCPDAG", _event);
				]]>
				</script>
				<assign location="system.LastSubmitRequestId" expr="_event.data.requestid"/>
				<assign location="varReqId" expr="_event.data.requestid"/>
			</transition>
			<transition event="queue.cancel.done" cond="_event.data.requestid==App_TargetByCPDAG['queue.submit.requestid']" target="$$_MY_PREFIX_$$.weWait1Sec">
				<log expr="'Composer Application: Main2 Block: TargetByCPDAG'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("TargetByCPDAG", _event);
				]]>
				</script>
			</transition>
			<transition event="error.interaction.redirect" cond="_event.data.requestid==App_TargetByCPDAG['requestid']" target="$$_MY_PREFIX_$$.weWait1Sec">
				<log expr="'Composer Application: Main2 Block: TargetByCPDAG'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("TargetByCPDAG", _event);
				]]>
				</script>
			</transition>
		</state>

		<!-- This is the forceLG State -->
		<state id="forceLG">
			<initial>
				<transition target="$$_MY_PREFIX_$$._reserved_forceLG_redirect">
					<log expr="'Inside ForceRoute Block: forceLG '"/>
				</transition>
			</initial>
			<state id="_reserved_forceLG_redirect">
				<onentry>
					<ixn:redirect detach="true" requestid="App_forceLG['requestid']" interactionid="system.InteractionID" from="system.ThisDN" to="routeDestination" type="_genesys.queue.rType.RouteTypeUnknown"/>
				</onentry>
			<transition event="interaction.redirect.done" cond="_event.data.requestid==App_forceLG['requestid']" target="$$_MY_PREFIX_$$.emsSetPayload4">
				<script>storeEvent("forceLG", _event);</script>
				<assign location="App_forceLG['interaction.redirect.requestid']" expr="_event.data.requestid"/>
			</transition>
			</state>
		</state>


	
	
	


	
		<!-- This is the subPreXferModule State -->
		<state id="subPreXferModule">
			<onentry>
				<dialog:start type="'applid'" interactionid="system.InteractionID" requestid="App_subPreXferModule['requestid']" device="system.ThisDN">
					<param name="APP_URI" expr="system.RelativePathURL+'src-gen/subPreXferCRD.vxml'" />
    				<param name="LANGUAGE" expr="'English (US)'" />
				</dialog:start>
			</onentry>
			<transition event="dialog.start.done" cond="_event.data.requestid == App_subPreXferModule['requestid']" target="$$_MY_PREFIX_$$.emsAttachIDCard">
				<script>storeEvent("subPreXferModule", _event);</script>
			</transition>
		</state>
	
	
	

		<!-- This is the bchCheckNPA State -->
		<state id="bchCheckNPA">
			<onentry>
				<log expr="_sessionid + ': Inside Branching Block: bchCheckNPA'" />
				<send event="'bchCheckNPA.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>				
			<transition event="bchCheckNPA.script.done" cond="outplayapp1.toLowerCase() === 'm0501' || outplayapp1.toLowerCase() === 'm0002' || outplayapp1.toLowerCase() === 'mh03'" target="$$_MY_PREFIX_$$.emsNPABusyTreatment">
			</transition>
			<transition event="bchCheckNPA.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.emsCPDBusyTreatment">
			</transition>
		</state>


	
	
	

		<!-- This is the TargetByNPAAG State -->
		<state id="TargetByNPAAG">
						
			<initial>
				<transition target="$$_MY_PREFIX_$$._reserved_TargetByNPAAG_submit">
					<log expr="_sessionid + ': Inside Target Block: TargetByNPAAG '"/>
				<log expr="'varSkillExpr - ' + varSkillExpr" level="2" />
				</transition>
			</initial>
			
			<state id="_reserved_TargetByNPAAG_submit">
				<onentry>
					<queue:submit route="false" requestid="App_TargetByNPAAG['requestid']" interactionid="system.InteractionID" queue="routeVQName" timeout="toNumber(_data.defaultTargetTimeout)" priority="toNumber(_data.defaultPriority)" clearontimeout="true" ordertype="'max'" orderstat="'StatAgentLoading'">
						<dialog:runtreatments>
							<!-- Busy treatment code is generated based on treatment blocks connected to this Target block -->	
				<!-- papBusyAnncNPA busy treatment block -->
				<dialog:start type="'applid'" interactionid="system.InteractionID" requestid="App_TargetByNPAAG['treatmentrequestid']">
					<param name="APP_URI" expr="system.RelativePathURL+'src-gen/subBusyAnncNPA.vxml'" />
    				<param name="LANGUAGE" expr="'English (US)'" />
				</dialog:start>
						</dialog:runtreatments>
						<queue:targets>
							<queue:targetid expr="routeTargetExpr"/>						
						</queue:targets>
					</queue:submit>
				</onentry>
				<transition event="queue.submit.requestid" cond="_event.data.requestid==App_TargetByNPAAG['requestid']">
					<script>storeEvent("TargetByNPAAG", _event);</script>
					<assign location="App_TargetByNPAAG['queue.submit.requestid']" expr="_event.data.requestid"/>
					<assign location="system.LastSubmitRequestId" expr="_event.data.requestid"/>
					<assign location="varReqId" expr="_event.data.requestid"/>
				</transition>
				<transition event="queue.submit.done" cond="_event.data.requestid==App_TargetByNPAAG['requestid']" target="$$_MY_PREFIX_$$._reserved_TargetByNPAAG_fetch_deviation">
					<log expr="'Target Selection DONE'" />
					<log expr="'Composer Application:Main2 Block: TargetByNPAAG'" />
					<log expr="'Target selected:' + _event.data.targetselected" />
					<if cond="typeof system.InteractionID != 'undefined' &amp;&amp; system.InteractionID != null &amp;&amp; _genesys.ixn.interactions[system.InteractionID] != null &amp;&amp; typeof _genesys.ixn.interactions[system.InteractionID] != 'undefined' &amp;&amp; typeof _genesys.ixn.interactions[system.InteractionID].voice != 'undefined'">
						<log expr="'_genesys.ixn.interactions[system.InteractionID].voice.ani: ' + _genesys.ixn.interactions[system.InteractionID].voice.ani" />
						<log expr="'_genesys.ixn.interactions[system.InteractionID].ani: ' + _genesys.ixn.interactions[system.InteractionID].ani" />
					<else/>
						<log expr="'Interaction is null'" />
					</if>
					<script>storeEvent("TargetByNPAAG", _event);</script>
					<assign location="system.LastTargetComponentSelected" expr="_event.data.targetcomponentselected"/>
					<assign location="system.LastTargetObjectSelected" expr="_event.data.targetobjectselected"/>
					<assign location="system.LastTargetSelected" expr="_event.data.targetselected"/>
					<assign location="system.LastVirtualQueueSelected" expr="_event.data.vqselected"/>
					<assign location="App_TargetByNPAAG['targetResource']" expr="_event.data.resource"/>
					</transition>
			</state>
			<state id="_reserved_TargetByNPAAG_submit_delay">
				<onentry>
					<send event="'TargetByNPAAG.aftersubmit.timeout.elapsed'" delay="'200ms'">
					<param name="resolveid" expr="_my_prefix"/>
					</send>
				</onentry>
				<transition event="TargetByNPAAG.aftersubmit.timeout.elapsed" cond="_event.data.resolveid == _my_prefix" target="$$_MY_PREFIX_$$._reserved_TargetByNPAAG_detach"/>
			</state>
			<state id="_reserved_TargetByNPAAG_detach" initial="$$_MY_PREFIX_$$._reserved_TargetByNPAAG_detach_run">
				<onentry>
					<log expr="'Detach the interaction ' + system.InteractionID"/>
					<script>var App_TargetByNPAAG_Detach_Timeout = new Date().getTime() + 300;</script>
				</onentry>
				<state id="_reserved_TargetByNPAAG_detach_run">
					<onentry>
						<log expr="'Detach attempt for interaction ' + system.InteractionID"/>
						<ixn:detach interactionid="system.InteractionID" requestid="App_TargetByNPAAG['requestid']"/>
					</onentry>
					<transition event="interaction.detach.done" cond="_event.data.requestid==App_TargetByNPAAG['requestid']" target="$$_MY_PREFIX_$$._reserved_TargetByNPAAG_redirect">
						<script>storeEvent("TargetByNPAAG", _event);</script>
				<assign location="App_TargetByNPAAG['interaction.detach.requestid']" expr="_event.data.requestid"/>
					</transition>
					<transition event="error.interaction.detach" cond="(_event.data.requestid==App_TargetByNPAAG['requestid']) &amp;&amp; (_event.data.error=='invalidstate') &amp;&amp; ((new Date().getTime() + 200) &lt; App_TargetByNPAAG_Detach_Timeout)" target="$$_MY_PREFIX_$$._reserved_TargetByNPAAG_detach_delay"/>
				</state>
				<state id="_reserved_TargetByNPAAG_detach_delay">
					<onentry>
						<send event="'TargetByNPAAG.afterdetach.timeout.elapsed'" delay="'200ms'"/>
					</onentry>
					<transition event="TargetByNPAAG.afterdetach.timeout.elapsed" target="$$_MY_PREFIX_$$._reserved_TargetByNPAAG_detach_run"/>
				</state>
			</state>
			<state id="_reserved_TargetByNPAAG_attach">
				<onentry>
					<log expr="'Attach the interaction back'" />
					<ixn:attach interactionid="system.InteractionID" requestid="App_TargetByNPAAG['requestid']"/>
				</onentry>
				<transition event="interaction.attach.done" cond="_event.data.requestid==App_TargetByNPAAG['requestid']">
					<script>storeEvent("TargetByNPAAG", _event);</script>
				<assign location="App_TargetByNPAAG['interaction.attach.requestid']" expr="_event.data.requestid"/>
					<script>
						App_TargetByNPAAG['requestid'] = App_TargetByNPAAG['error.rethrow'].params.requestid;
						__Raise(App_TargetByNPAAG['error.rethrow'].name, App_TargetByNPAAG['error.rethrow'].params);
					</script>
				</transition>
			</state>
			<state id="_reserved_TargetByNPAAG_fetch_deviation">
				<transition target="$$_MY_PREFIX_$$._reserved_TargetByNPAAG_redirect">
					<log expr="_sessionid + ': Target Deviation from Ideal Agent'" />
				</transition>
			</state>
			<state id="_reserved_TargetByNPAAG_redirect">
				<onentry>
					<log expr="_sessionid + ': Inside Target Redirect: TargetByNPAAG '" />
					<ixn:redirect detach="true" requestid="App_TargetByNPAAG['requestid']" interactionid="system.InteractionID" from="system.ThisDN" to="App_TargetByNPAAG['targetResource']" type="_genesys.queue.rType.RouteTypeDefault" hints="varRouteHint"/>
				</onentry>
			<transition event="interaction.redirect.done" cond="_event.data.requestid==App_TargetByNPAAG['requestid']" target="$$_MY_PREFIX_$$.emsSetPayload4">
				<script>storeEvent("TargetByNPAAG", _event);</script>
				<assign location="App_TargetByNPAAG['interaction.redirect.requestid']" expr="_event.data.requestid"/>
			</transition>
				
			</state>
			<transition event="error.queue.submit" cond="_event.data.requestid==App_TargetByNPAAG['requestid']" target="$$_MY_PREFIX_$$.WaitEvent1">
				<log expr="'Composer Application: Main2 Block: TargetByNPAAG'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("TargetByNPAAG", _event);
				]]>
				</script>
				<assign location="system.LastSubmitRequestId" expr="_event.data.requestid"/>
				<assign location="varReqId" expr="_event.data.requestid"/>
			</transition>
			<transition event="queue.cancel.done" cond="_event.data.requestid==App_TargetByNPAAG['queue.submit.requestid']" target="$$_MY_PREFIX_$$.WaitEvent1">
				<log expr="'Composer Application: Main2 Block: TargetByNPAAG'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("TargetByNPAAG", _event);
				]]>
				</script>
			</transition>
			<transition event="error.interaction.redirect" cond="_event.data.requestid==App_TargetByNPAAG['requestid']" target="$$_MY_PREFIX_$$.WaitEvent1">
				<log expr="'Composer Application: Main2 Block: TargetByNPAAG'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("TargetByNPAAG", _event);
				]]>
				</script>
			</transition>
		</state>

		<!-- This is the emsCPDBusyTreatment State -->
		<state id="emsCPDBusyTreatment">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsCPDBusyTreatment'"/>
				<script>
					(function(){
					    try {
					        // your code	
					/*         
					        var now = new Date();
					        const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
					        var day = days[ now.getDay()];
					 */
					 		
					        __Log('outplayapp1 : ' + outplayapp1);
					        var treatmentObj = _genesys.session.getListItemValue(routeBusyTreatment, 'treatment');      
							if (isEmpty(treatmentObj)){
								__Log('No Treatment Config for IVR Menu ' + outplayapp1 + '. System will abort busy treatment');
					            return;
					        } else {
								__Log('Load Treatment Config for IVR Menu '+outplayapp1+' successful');
					        }
					        
					        __Log('Treatment List :' + JSON.stringify(treatmentObj));	
					                
							var v_kvlist = new Object();
							v_kvlist['BusyPrompt1ARID'] = getJSONContent(treatmentObj, 'Prompt1ARID');
							v_kvlist['BusyPrompt1Timeout'] = getJSONContent(treatmentObj, 'Prompt1Timeout');
							v_kvlist['BusyPrompt2ARID'] = getJSONContent(treatmentObj, 'Prompt2ARID');
							v_kvlist['BusyPrompt2Timeout'] = getJSONContent(treatmentObj, 'Prompt2Timeout');
							
					        _genesys.ixn.setuData(v_kvlist, system.InteractionID);
					        
					    } catch (error) {
					        // error handling code
					        __Log('@@@@@@ Exception Found - ' + error + ' @@@@@@');
					        __Log('System will abort busy treatment');
					        
							throw new Error('Exception_GetBusyTreatmentConfig'); 
					    }
					})();
				</script>
				<send event="'emsCPDBusyTreatment.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsCPDBusyTreatment.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.TargetByCPDAG">
				<script>storeEvent("emsCPDBusyTreatment", _event);</script>
			</transition>
		</state>

		<!-- This is the bchIsPreXferEnable State -->
		<state id="bchIsPreXferEnable">
			<onentry>
				<log expr="_sessionid + ': Inside Branching Block: bchIsPreXferEnable'" />
				<send event="'bchIsPreXferEnable.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>				
			<transition event="bchIsPreXferEnable.script.done" cond="routePreXferTreatement === &quot;n/a&quot;" target="$$_MY_PREFIX_$$.SetRouteHint">
			</transition>
			<transition event="bchIsPreXferEnable.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.emsGetPreXferConfig">
			</transition>
		</state>

		<!-- This is the emsGetPreXferConfig State -->
		<state id="emsGetPreXferConfig">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsGetPreXferConfig'"/>
				<script>
					(function(){
					    try {
					        // your code	
					/*         
					        var now = new Date();
					        const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
					        var day = days[ now.getDay()];
					 */
					 		
					        __Log('outplayapp1 : ' + outplayapp1);
					        var treatmentObj = _genesys.session.getListItemValue(routePreXferTreatement, 'treatment');      
							if (isEmpty(treatmentObj)){
								__Log('No Treatment Config for IVR Menu ' + outplayapp1 + '. System will abort Pre-Transfer treatment');
					            return;
					        } else {
								__Log('Load Treatment Config for IVR Menu '+outplayapp1+' successful');
					        }
					        
					        __Log('Treatment List :' + JSON.stringify(treatmentObj));	
					                
							var v_kvlist = new Object();
							v_kvlist['PreXferRequireIdCardNo'] = getJSONContent(treatmentObj, 'require_id-card-no');
							v_kvlist['PreXferPrepareCardPrompt'] = getJSONContent(treatmentObj, 'prepare_card_prompt');
							v_kvlist['PreXferEntryCardNoPrompt'] = getJSONContent(treatmentObj, 'entry_card-no_prompt');
							v_kvlist['PreXferErrorNoInput'] = getJSONContent(treatmentObj, 'idcard_noinput');
							v_kvlist['PreXferErrorNoMatch'] = getJSONContent(treatmentObj, 'idcard_nomatch');
							v_kvlist['PreXferErrorMaxNoInput'] = getJSONContent(treatmentObj, 'idcard_max_noinput');
							v_kvlist['PreXferErrorMaxNoMatch'] = getJSONContent(treatmentObj, 'idcard_max_nomatch');
							v_kvlist['PreXferErrprMaxRetry'] = getJSONContent(treatmentObj, 'idcard_max_retry');
							v_kvlist['PreXferPrompt'] = getJSONContent(treatmentObj, 'pre-xfer_prompt');
							
					        _genesys.ixn.setuData(v_kvlist, system.InteractionID);
					        
					    } catch (error) {
					        // error handling code
					        __Log('@@@@@@ Exception Found - ' + error + ' @@@@@@');
					        __Log('System will abort Pre-Xfer treatment');
					        
							throw new Error('Exception_GetPreXferConfig'); 
					    }
					})();
				</script>
				<send event="'emsGetPreXferConfig.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsGetPreXferConfig.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.subPreXferModule">
				<script>storeEvent("emsGetPreXferConfig", _event);</script>
			</transition>
			<transition event="error" target="$$_MY_PREFIX_$$.SetRouteHint">
				<log expr="'Composer Application: Main2 Block: emsGetPreXferConfig'" />
				<log expr="'ERROR: ' + _event.toSource()" />
				<script>
				<![CDATA[
					storeException("emsGetPreXferConfig", _event);
				]]>
				</script>
			</transition>
		</state>

		<!-- This is the emsNPABusyTreatment State -->
		<state id="emsNPABusyTreatment">
			<onentry>
				<log expr="_sessionid + ': Inside Script Block: emsNPABusyTreatment'"/>
				<script>
					(function(){
					    try {
					        // your code	
					/*         
					        var now = new Date();
					        const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
					        var day = days[ now.getDay()];
					 */
					 		
					        __Log('outplayapp1 : ' + outplayapp1);
					        __Log('routeBusyTreatment : ' + routeBusyTreatment);
					       								   
					        var treatmentObj = _genesys.session.getListItemValue(routeBusyTreatment, 'treatment');      
							if (isEmpty(treatmentObj)){
								__Log('No Treatment Config for IVR Menu ' + outplayapp1 + '. System will abort busy treatment');
					            return;
					        } else {
								__Log('Load Treatment Config for IVR Menu '+outplayapp1+' successful');
					        }
					        
					        __Log('Treatment List :' + JSON.stringify(treatmentObj));	
					
							var v_kvlist = new Object();
							v_kvlist['NpaBusyGreeting1'] = getJSONContent(treatmentObj, 'Greeting1');
							v_kvlist['NpaBusyGreeting2'] = getJSONContent(treatmentObj, 'Greeting2');
							v_kvlist['NpaBusyMainMenu'] = getJSONContent(treatmentObj, 'MainMenu');
							v_kvlist['NpaBusyNoInput'] = getJSONContent(treatmentObj, 'NoInput');
							v_kvlist['NpaBusyNoMatch'] = getJSONContent(treatmentObj, 'NoMatch');
							v_kvlist['NpaBusyMaxNoInput'] = getJSONContent(treatmentObj, 'MaxNoInput');
							v_kvlist['NpaBusyMaxNoMatch'] = getJSONContent(treatmentObj, 'MaxNoMatch');
							v_kvlist['NpaBusyMaxRetryCount'] = getJSONContent(treatmentObj, 'MaxRetryCount');
							
							v_kvlist['NpaBusyInfo1'] = getJSONContent(treatmentObj, 'Info1');
							v_kvlist['NpaBusyInfo2'] = getJSONContent(treatmentObj, 'Info2');
							v_kvlist['NpaBusyInfo3'] = getJSONContent(treatmentObj, 'Info3');
							
							v_kvlist['NpaBusyMOH'] = getJSONContent(treatmentObj, 'MusicOnHold');
							v_kvlist['NpaBusyMOHTimeout'] = getJSONContent(treatmentObj, 'MusicOnHoldTimeout');
							
							
					        _genesys.ixn.setuData(v_kvlist, system.InteractionID);
					
					        
					    } catch (error) {
					        // error handling code
					        __Log('@@@@@@ Exception Found - ' + error + ' @@@@@@');
					        __Log('System will abort busy treatment');
					        
							throw new Error('Exception_GetBusyTreatmentConfig'); 
					    }
					})();
				</script>
				<send event="'emsNPABusyTreatment.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="emsNPABusyTreatment.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.TargetByNPAAG">
				<script>storeEvent("emsNPABusyTreatment", _event);</script>
			</transition>
		</state>

		<!-- This is the WaitEvent1 State -->
		<state id="WaitEvent1">
			<onentry>

				<send event="'WaitEvent1.wait.timeout'" delay="'30s'">
				<param name="resolveid" expr="_my_prefix"/>
				</send>
			</onentry>
			<transition event="WaitEvent1.wait.timeout" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.AddPriority2">
				<script>storeEvent("WaitEvent1", _event);</script>
			</transition>
		</state>

		<!-- This is the weWait1Sec State -->
		<state id="weWait1Sec">
			<onentry>

				<send event="'weWait1Sec.wait.timeout'" delay="'1s'">
				<param name="resolveid" expr="_my_prefix"/>
				</send>
			</onentry>
			<transition event="Done" target="$$_MY_PREFIX_$$.AddPriority1">
				<script>storeEvent("weWait1Sec", _event);</script>
			</transition>
			<transition event="weWait1Sec.wait.timeout" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.AddPriority1">
				<script>storeEvent("weWait1Sec", _event);</script>
			</transition>
		</state>

		<!-- This is the AddPriority1 State -->
		<state id="AddPriority1">
			<onentry>
				<log expr="_sessionid + ': Inside Assign Block: AddPriority1'" />
				<script>
					routePriority = _data.defaultPriority + 2;					
						
				</script>
				<send event="'AddPriority1.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="AddPriority1.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.TargetByCPDAG">
				<script>storeEvent("AddPriority1", _event);</script>
			</transition>
		</state>

		<!-- This is the AddPriority2 State -->
		<state id="AddPriority2">
			<onentry>
				<log expr="_sessionid + ': Inside Assign Block: AddPriority2'" />
				<script>
					routePriority = _data.defaultPriority + 2;					
						
				</script>
				<send event="'AddPriority2.script.done'">
    	<param name="resolveid" expr="_my_prefix"/>
    	</send>
			</onentry>
			<transition event="AddPriority2.script.done" cond="_event.data.resolveid== _my_prefix" target="$$_MY_PREFIX_$$.TargetByNPAAG">
				<script>storeEvent("AddPriority2", _event);</script>
			</transition>
		</state>
			
		<!-- This is the emsSetMainParam State in Disabled mode -->
		<state id="emsSetMainParam">
			<onentry>
				<log expr="_sessionid + ': emsSetMainParam block is currently disabled'" />
			</onentry>
			<transition target="$$_MY_PREFIX_$$.UserData1">
			</transition>
		</state>
	</state>
	
</scxml>
